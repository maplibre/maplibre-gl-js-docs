<!doctype html><html lang="en"><head><title data-react-helmet="true">Display HTML clusters with custom properties | MapLibre GL JS Docs | MapLibre</title>

<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" name="msapplication-TileColor" content="#ffffff"/><meta data-react-helmet="true" name="msapplication-config" content="/maplibre-gl-js-docs/assets/favicon/browserconfig.xml?v=rMBbQAR5BL"/><meta data-react-helmet="true" name="theme-color" content="#ffffff"/><meta data-react-helmet="true" name="twitter:site" content="@MapLibre"/><meta data-react-helmet="true" property="og:site_name" content="MapLibre"/><meta data-react-helmet="true" name="description" content="Extend clustering with HTML markers and custom property expressions."/><meta data-react-helmet="true" name="twitter:title" content="Display HTML clusters with custom properties | MapLibre GL JS Docs"/><meta data-react-helmet="true" property="og:title" content="Display HTML clusters with custom properties | MapLibre GL JS Docs"/><meta data-react-helmet="true" name="twitter:description" content="Extend clustering with HTML markers and custom property expressions."/><meta data-react-helmet="true" property="og:description" content="Extend clustering with HTML markers and custom property expressions."/><meta data-react-helmet="true" property="og:url" content="https://maplibre.org/maplibre-gl-js-docs/example/cluster-html/"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" class="swiftype" name="title" data-type="string" content="Display HTML clusters with custom properties"/><meta data-react-helmet="true" class="swiftype" name="excerpt" data-type="string" content="Extend clustering with HTML markers and custom property expressions."/><meta data-react-helmet="true" name="twitter:image:alt" content="MapLibre"/><meta data-react-helmet="true" property="og:image" content="https://static-assets.mapbox.com/branding/social/social-1200x630.v1.png"/><meta data-react-helmet="true" class="swiftype" name="image" data-type="enum" content="https://static-assets.mapbox.com/branding/social/social-1200x630.v1.png"/><meta data-react-helmet="true" class="swiftype" name="site" data-type="string" content="MapLibre GL JS Docs"/><meta data-react-helmet="true" class="swiftype" name="contentType" data-type="string" content="example"/><meta data-react-helmet="true" class="swiftype" name="codeLanguage" data-type="string" content="JavaScript"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:image" content="https://static-assets.mapbox.com/branding/social/social-1200x630.v1.png"/>
<link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/maplibre-gl-js-docs/assets/favicon/apple-touch-icon.png?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/maplibre-gl-js-docs/assets/favicon/favicon-32x32.png?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/maplibre-gl-js-docs/assets/favicon/favicon-16x16.png?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="manifest" href="/maplibre-gl-js-docs/assets/favicon/site.webmanifest?v=rMBbQAR5BL"/><link data-react-helmet="true" rel="mask-icon" href="/maplibre-gl-js-docs/assets/favicon/safari-pinned-tab.svg?v=rMBbQAR5BL" color="#4264fb"/><link data-react-helmet="true" rel="shortcut icon" href="/maplibre-gl-js-docs/assets/favicon/favicon.ico?v=rMBbQAR5BL"/>
<script>!function(){"use strict";var r=!1;function n(){var e,t;r&&(e=document.getElementById("page-shell"),t=document.getElementById("mobile-nav-backdrop"),e&&t&&(e.style.height="",e.style.overflow="",e.style.overflowX="hidden",t.classList.remove("shell-mobile-nav__backdrop--visible"),r=!1))}var e=640,a=window.document.createElement("div"),d=["webkit","moz","o","ms"],i={};function s(e,t){return e+concat(concat((n=t).charAt(0).toUpperCase()).concat(n.substr(1)))}function o(e,t){return e in(1<arguments.length&&void 0!==t?t:window)}function m(t,e,n){e=1<arguments.length&&void 0!==e&&e;return t in(2<arguments.length&&void 0!==n?n:a).style||!!e&&d.some(function(e){return m(s(e,t))})}function c(n,i,e,t){var e=2<arguments.length&&void 0!==e?e:{},t=3<arguments.length&&void 0!==t?t:a,o=e.allowPrefixedProp,l=e.allowPrefixedValue,e=!1;return(e=o||l?d.some(function(e){return c(o?s(e,n):n,l?(t=i,"-".concat(e,"-").concat(t)):i);var t}):e)||(t.style[n]=i,t.style[n]===i)}function t(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a;(i={flexBox:m("flex",e,t)&&c("display","flex",{allowPrefixedProp:!1,allowPrefixedValue:e},t),viewportUnits:c("width","100vw",{allowPrefixedProp:!1,allowPrefixedValue:!1},t),visibilityState:o("visibilityState",window.document),devicePixelRatio:o("devicePixelRatio")}).doesCutMustard=Object.keys(i).every(function(e){return i[e]})}function l(){var e=window.document.getElementById("page-shell-compatibility-dismiss"),t=window.document.getElementById("page-shell-compatibility-warning");e&&e.removeEventListener("click",l),t&&(t.style.display="none"),window.localStorage&&window.localStorage.setItem("suppress-browser-compatibility-warning","true")}function u(){window.matchMedia("(min-width: "+e+"px)").matches&&g()}function g(){var e=document.getElementById("mobile-nav-menu"),t=document.getElementById("page-header-content");e.classList.remove("shell-animated-menu--visible"),t.classList.remove("shell-mobile-nav--visible"),m("textOrientation",!0)||(document.querySelector(".shell-mobile-nav__trigger__bar--top").setAttribute("transform",""),document.querySelector(".shell-mobile-nav__trigger__bar--bottom").setAttribute("transform","")),n(),window.removeEventListener("resize",u)}function v(e){var t,n,i=document.getElementById("mobile-nav-trigger-toggle"),o=document.getElementById("mobile-nav-menu"),l=document.getElementById("page-header-content"),a=document.getElementById("mbx-user-menu-mobile");e.target.getAttribute&&e.target.getAttribute("data-nav-link")?(document.documentElement.scrollTop=0,document.body.scrollTop=0,g()):i.contains(e.target)?(i=document.getElementById("mobile-nav-menu"),n=document.getElementById("page-header-content"),i.classList.add("shell-animated-menu--visible"),n.classList.add("shell-mobile-nav--visible"),m("textOrientation",!0)||(document.querySelector(".shell-mobile-nav__trigger__bar--top").setAttribute("transform","translate(6 -1) rotate(45)"),document.querySelector(".shell-mobile-nav__trigger__bar--bottom").setAttribute("transform","translate(-6.5 6) rotate(-45)")),r||(i=document.getElementById("page-shell"),n=document.getElementById("mobile-nav-menu"),t=document.getElementById("mobile-nav-backdrop"),n&&i&&t&&(n=Math.max(n.getBoundingClientRect().bottom+120,window.innerHeight),i.style.height=n+"px",i.style.overflow="hidden",t.classList.add("shell-mobile-nav__backdrop--visible"),t.style.height=n-parseInt(t.style.top)+"px",r=!0)),window.addEventListener("resize",u)):(o.contains(e.target)||l.contains(e.target))&&!a.contains(e.target)||g()}(window.MapboxPageShell={afterUserCheck:function(){},removeNavigation:function(){document.removeEventListener("click",v)},initialize:function(){var e=function(){var e;document.addEventListener("click",v),null==i.doesCutMustard&&t(!0),i.doesCutMustard||"localStorage"in window&&"true"===window.localStorage.getItem("suppress-browser-compatibility-warning")||(window.document.getElementById("page-shell-compatibility-warning").style.display="block",(e=window.document.getElementById("page-shell-compatibility-dismiss"))&&e.addEventListener("click",l))};"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)},generateCompatibilitySummary:t,getCompatibilitySummary:function(){return i}}).initialize()}();</script>

<style>a,aside,code,div,footer,form,h1,header,html,li,nav,p,pre,span,ul{margin:0;padding:0;border:0;font-size:100%;vertical-align:baseline}body{padding:0;vertical-align:baseline}aside,footer,header,main,nav,pre{display:block}html{box-sizing:border-box}h1{font-weight:400}*,::after,::before,:after,:before{box-sizing:inherit}ul{list-style:none}body,button{margin:0;border:0}button{background:0 0;color:inherit;font:inherit;padding:0;width:auto;text-align:left;-webkit-appearance:none;appearance:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;border-radius:0}button:disabled{cursor:default}.shell-wrapper button::-moz-focus-inner,button::-moz-focus-inner{padding:0;border:0}a{text-decoration:none;color:inherit}.btn,.shell-wrapper svg,svg{display:inline-block}pre{white-space:pre-wrap;tab-size:2}@font-face{font-family:'Open Sans';font-weight:400;src:url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-regular.v1.woff2) format('woff2'),url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-regular.v1.woff) format('woff')}@font-face{font-family:'Open Sans';font-weight:300;src:url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-light.v1.woff2) format('woff2'),url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-light.v1.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;src:url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-italic.v1.woff2) format('woff2'),url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-italic.v1.woff) format('woff')}@font-face{font-family:'Open Sans';font-weight:700;src:url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-bold.v1.woff2) format('woff2'),url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-bold.v1.woff) format('woff')}@font-face{font-family:'Open Sans';font-weight:700;font-style:italic;src:url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-bolditalic.v1.woff2) format('woff2'),url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-bolditalic.v1.woff) format('woff')}.btn{font-weight:700;background-color:#4264fb;font-size:12px;color:#fff;border-radius:18px;padding:6px 18px;text-align:center;transition:background-color .125s,border-color .125s,color .125s}.btn--s{font-size:10px;line-height:18px;padding:3px 12px;border-radius:15px}.btn:hover{background-color:#314ccd}.btn:disabled{pointer-events:none;color:rgba(147,167,191,.45);background-color:rgba(147,167,191,.25);box-shadow:none}.link{cursor:pointer;color:#4264fb;transition:color .125s}.link:hover{color:#314ccd}.link:disabled{cursor:default;color:rgba(147,167,191,.45)}.link:disabled,input:disabled{pointer-events:none}body,input{color:#1f3349;font-size:15px;line-height:24px;font-family:'Open Sans',sans-serif;font-weight:400;-webkit-font-smoothing:antialiased}.prose code:not(.unprose),.prose pre:not(.unprose){font-family:'Menlo','Bitstream Vera Sans Mono','Monaco','Consolas',monospace;white-space:pre-wrap;font-size:90%;line-height:1.5em;background:rgba(31,51,73,.05);border-radius:3px}.prose pre:not(.unprose){padding:12px;overflow:auto;margin-bottom:12px}.prose pre code:not(.unprose){background:0 0;padding:0}.prose code:not(.unprose){padding:2px 4px}.txt-l{font-size:18px;line-height:30px}.txt-s{font-size:12px;line-height:18px}.prose p:not(.unprose){margin-bottom:12px}.txt-uppercase{text-transform:uppercase!important}.prose h1:not(.unprose){font-weight:700;font-size:45px;line-height:54px;margin-bottom:12px;padding-top:36px}.prose h1:first-child:not(.unprose){padding-top:0}.prose :last-child:not(.unprose){margin-bottom:0}.align-t{vertical-align:top!important}.border-b{border-style:solid;border-bottom-width:1px}.round{border-radius:4px!important}.round-full{border-radius:9999px!important}.cursor-pointer{cursor:pointer!important}.icon{display:block;fill:currentColor;height:1em;width:1em}.limiter{padding-left:24px;padding-right:24px;width:100%}@media screen and (min-width:640px){.limiter{margin-left:auto;margin-right:auto;width:91.666666666%;max-width:1200px;padding-left:0;padding-right:0}}@media screen and (min-width:800px){.limiter{width:83.33333333%}}.grid{display:-webkit-flex!important;display:flex!important;-webkit-flex-wrap:wrap!important;flex-wrap:wrap!important}.col{display:block;max-width:100%;-webkit-flex-basis:0;flex-basis:0;-webkit-flex-grow:1;flex-grow:1;-webkit-flex-shrink:1;flex-shrink:1}.col--12{-webkit-flex:none;flex:none;width:100%!important}.block{display:block!important}.inline-block{display:inline-block!important}.none{display:none!important}.fixed{position:fixed!important}.absolute{position:absolute!important}.relative{position:relative!important}.top{top:0!important}.right{right:0!important}.bottom{bottom:0!important}.z0{z-index:0!important}.z2{z-index:2!important}.z5{z-index:5!important}.flex-parent{display:-webkit-flex!important;display:flex!important}.flex-parent--center-main{-webkit-justify-content:center!important;justify-content:center!important}.flex-parent--center-cross{-webkit-align-items:center!important;align-items:center!important}.flex-parent--space-between-main{-webkit-justify-content:space-between!important;justify-content:space-between!important}.flex-child{display:block;max-width:100%}.flex-child--grow{-webkit-flex-grow:1!important;flex-grow:1!important;min-width:0}.flex-child--no-shrink{-webkit-flex-shrink:0!important;flex-shrink:0!important}.grid--gut60{margin-left:-60px}.grid--gut60>.col{padding-left:60px}.my24{margin-top:24px!important;margin-bottom:24px!important}.mx-neg12{margin-left:-12px!important;margin-right:-12px!important}.mx24{margin-left:24px!important;margin-right:24px!important}.mt6{margin-top:6px!important}.mr6{margin-right:6px!important}.mb6{margin-bottom:6px!important}.ml3{margin-left:3px!important}.ml6{margin-left:6px!important}.py3{padding-top:3px!important;padding-bottom:3px!important}.py6{padding-top:6px!important;padding-bottom:6px!important}.px0{padding-left:0!important;padding-right:0!important}.px3{padding-left:3px!important;padding-right:3px!important}.px6{padding-left:6px!important;padding-right:6px!important}.px12{padding-left:12px!important;padding-right:12px!important}.pt3{padding-top:3px!important}.pr6{padding-right:6px!important}.pr12{padding-right:12px!important}.pb12{padding-bottom:12px!important}.w60{width:60px!important}.w-full{width:100%!important}.wmax240{max-width:240px!important}.h60{height:60px!important}@media screen and (min-width:640px){.mr36-mm{margin-right:36px!important}.mb0-mm{margin-bottom:0!important}.py3-mm{padding-top:3px!important;padding-bottom:3px!important}.px0-mm{padding-left:0!important;padding-right:0!important}.px12-mm{padding-left:12px!important;padding-right:12px!important}.w180-mm{width:180px!important}}@media screen and (min-width:800px){.w240-ml{width:240px!important}}.prose pre::-webkit-scrollbar,.scroll-styled::-webkit-scrollbar{width:6px;height:6px;background:0 0}.prose pre::-webkit-scrollbar:hover,.scroll-styled::-webkit-scrollbar:hover{background:0 0}.scroll-styled::-webkit-scrollbar-track{background:0 0}.scroll-styled::-webkit-scrollbar-thumb{background:rgba(0,0,0,.25);border-color:transparent;width:6px;border-radius:3px}.prose pre::-webkit-scrollbar-thumb:hover,.scroll-styled::-webkit-scrollbar-thumb:hover{background:rgba(0,0,0,.35)}.prose pre::-webkit-scrollbar-track,.prose pre::-webkit-scrollbar-track:hover,.scroll-styled::-webkit-scrollbar-track:hover{background:0 0}.events-none{-webkit-touch-callout:none;pointer-events:none}.hide-visually{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap}@font-face{font-family:'Cera';font-weight:700;src:url(https://api.mapbox.com/mapbox-assembly/fonts/CeraPRO-Bold.v1.woff2) format('woff2'),url(https://api.mapbox.com/mapbox-assembly/fonts/CeraPRO-Bold.v1.woff) format('woff')}@font-face{font-family:'Cera';font-style:italic;src:url(https://api.mapbox.com/mapbox-assembly/fonts/CeraPRO-BoldItalic.v1.woff2) format('woff2'),url(https://api.mapbox.com/mapbox-assembly/fonts/CeraPRO-BoldItalic.v1.woff) format('woff')}body{-webkit-text-size-adjust:100%;text-size-adjust:100%}.txt-fancy{font-family:'Cera','Open Sans',sans-serif!important;font-weight:700}.btn--blue{background-color:#4264fb}.btn--blue:hover,.shell-wrapper .shell-btn:hover{background-color:#314ccd}.color-gray{color:#5b7897!important}.color-gray-light{color:#c6d2e1!important}.color-blue,.color-blue-on-hover:hover{color:#4264fb!important}.color-darken50{color:rgba(31,51,73,.5)!important}.color-darken75{color:rgba(31,51,73,.75)!important}.color-white{color:#fff!important}.bg-blue-faint{background-color:#edf0fd!important}.bg-white{background-color:#fff!important}.border--darken10{border-color:rgba(31,51,73,.1)!important}.shadow-darken25{box-shadow:0 0 10px 2px rgba(31,51,73,.25)!important}@media screen and (min-width:640px){.block-mm{display:block!important}.inline-block-mm{display:inline-block!important}.none-mm{display:none!important}.absolute-mm{position:absolute!important}.viewport-almost-mm{height:90vh!important}.flex-parent-mm{display:-webkit-flex!important;display:flex!important}}@media screen and (min-width:1200px){.col--4-mxl,.col--8-mxl{-webkit-flex:none;flex:none;width:33.3333%!important}.col--8-mxl{width:66.6666%!important}.viewport-almost-mxl{height:90vh!important}}@media screen and (min-width:640px){.limiter--wide{max-width:1800px!important}}@media screen and (min-width:800px){.limiter--wide{width:91.666666666%!important}}#docs-content .prose h1{margin-top:6px;margin-bottom:30px;font-size:36px}.prose pre::-webkit-scrollbar-thumb{background:rgba(0,0,0,.25);border-color:transparent;width:6px;border-radius:3px}@media screen and (min-width:640px){.scroll-auto-mm{overflow:auto!important;-webkit-overflow-scrolling:touch}.sticky-mm{position:-webkit-sticky;position:sticky}}@media screen and (min-width:1200px){.sticky-mxl{position:-webkit-sticky;position:sticky}.scroll-auto-mxl{overflow:auto!important;-webkit-overflow-scrolling:touch}.dr-ui--page-layout-aside{-webkit-order:2;order:2}}.prose pre{margin-bottom:18px!important}.token.comment,.token.doctype{color:#53708e}.token.punctuation{color:#273d56}.token.constant,.token.property,.token.tag{color:#314ccd}.token.boolean,.token.number{color:#7753eb}.token.attr-name,.token.selector,.token.string{color:#ce2c69}.token.operator{color:#273d56}.token.attr-value,.token.class-name,.token.function{color:#385af5}.token.keyword{color:#314ccd}.shell-wrapper{box-sizing:border-box}.shell-wrapper *,.shell-wrapper ::after,.shell-wrapper ::before{box-sizing:inherit}.shell-wrapper{color:#1f3349;font-size:15px!important;line-height:24px;font-family:'Open Sans',sans-serif;font-weight:400;-webkit-font-smoothing:antialiased}.shell-wrapper button{background:0 0;border:0;color:inherit;font:inherit;margin:0;padding:0;width:auto;text-align:left;-webkit-appearance:none;appearance:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer}.shell-wrapper a{color:inherit;text-decoration:none}@font-face{font-family:'Open Sans';font-weight:400;src:url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-regular.v1.woff2) format('woff2'),url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-regular.v1.woff) format('woff')}@font-face{font-family:'Open Sans';font-weight:700;src:url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-bold.v1.woff2) format('woff2'),url(https://api.mapbox.com/mapbox-assembly/fonts/opensans-bold.v1.woff) format('woff')}.shell-wrapper .shell-txt-bold{font-weight:700!important}.shell-wrapper .shell-txt-l{font-size:18px!important;line-height:30px}.shell-wrapper .shell-txt-s{font-size:12px!important;line-height:18px}.shell-wrapper .shell-txt-nowrap{white-space:nowrap!important}.shell-wrapper .shell-align-l{text-align:left!important}.shell-wrapper .shell-align-center{text-align:center!important}.shell-wrapper .shell-btn{display:inline-block;background-color:#448ee4;color:#fff;border-radius:18px;padding:6px 12px;font-weight:700;text-align:center;transition:background-color .125s,border-color .125s,color .125s}.shell-wrapper .shell-btn--white{background-color:#fff!important}.shell-wrapper .shell-btn--white:hover{background-color:rgba(255,255,255,.75)}.shell-wrapper .shell-link{cursor:pointer;color:#448ee4;transition:color .125s}.shell-wrapper .shell-link:hover{color:#346db0}.shell-wrapper .shell-border-t{border-top:1px solid!important}.shell-wrapper .shell-icon{display:block;fill:currentColor;height:18px;width:18px}.shell-wrapper .shell-icon--s{height:15px!important;width:15px!important}.shell-wrapper .shell-icon--l{height:36px!important;width:36px!important}.shell-wrapper .shell-grid{display:-webkit-flex!important;display:flex!important;-webkit-flex-wrap:wrap!important;flex-wrap:wrap!important}.shell-wrapper .shell-col{display:block!important;max-width:100%;-webkit-flex-shrink:0!important;flex-shrink:0!important;-webkit-flex-basis:auto!important;flex-basis:auto!important}.shell-wrapper .shell-col--12{width:100%!important}.shell-wrapper .shell-inline{display:inline!important}.shell-wrapper .shell-inline-block{display:inline-block!important}.shell-wrapper .shell-block{display:block!important}.shell-wrapper .shell-none{display:none!important}.shell-wrapper .shell-absolute{position:absolute!important}.shell-wrapper .shell-relative{position:relative!important}.shell-wrapper .shell-top{top:0!important}.shell-wrapper .shell-bottom{bottom:0!important}.shell-wrapper .shell-left{left:0!important}.shell-wrapper .shell-right{right:0!important}.shell-wrapper .shell-z1{z-index:1!important}.shell-wrapper .shell-z2{z-index:2!important}.shell-wrapper .shell-z5{z-index:5!important}.shell-flex-parent,.shell-wrapper .shell-flex-parent{display:-webkit-flex;display:flex}.shell-flex-parent--column{-webkit-flex-direction:column!important;flex-direction:column!important}.shell-wrapper .shell-flex-parent--center-cross{-webkit-align-items:center!important;align-items:center!important}.shell-wrapper .shell-flex-parent--end-main{-webkit-justify-content:flex-end!important;justify-content:flex-end!important}.shell-flex-child,.shell-wrapper .shell-flex-child{display:block;max-width:100%}.shell-flex-child--grow,.shell-wrapper .shell-flex-child--grow{-webkit-flex-grow:1!important;flex-grow:1!important;min-width:0}.shell-flex-child--no-shrink{-webkit-flex-shrink:0!important;flex-shrink:0!important}.shell-wrapper .shell-my12{margin-top:12px!important;margin-bottom:12px!important}.shell-wrapper .shell-ml12{margin-left:12px!important}.shell-wrapper .shell-ml-neg6{margin-left:-6px!important}.shell-wrapper .shell-mx12{margin-left:12px!important;margin-right:12px!important}.shell-wrapper .shell-mt24{margin-top:24px!important}.shell-wrapper .shell-mr18{margin-right:18px!important}.shell-wrapper .shell-mb6{margin-bottom:6px!important}.shell-wrapper .shell-ml6{margin-left:6px!important}.shell-wrapper .shell-p12{padding:12px!important}.shell-wrapper .shell-py12{padding-top:12px!important;padding-bottom:12px!important}.shell-wrapper .shell-py24{padding-top:24px!important;padding-bottom:24px!important}.shell-wrapper .shell-px24{padding-left:24px!important;padding-right:24px!important}.shell-wrapper .shell-pb24{padding-bottom:24px!important}.shell-wrapper .shell-w36{width:36px!important}.shell-wrapper .shell-w-full{width:100%!important}.shell-wrapper .shell-h24{height:24px!important}@media screen and (min-width:640px){.shell-wrapper .shell-col--6-mm{width:50%!important}.shell-wrapper .shell-none-mm{display:none!important}.shell-wrapper .shell-flex-parent-mm{display:-webkit-flex!important;display:flex!important}.shell-wrapper .shell-mb0-mm{margin-bottom:0!important}.shell-wrapper .shell-align-l-mm{text-align:left!important}.shell-wrapper .shell-align-r-mm{text-align:right!important}}@media screen and (min-width:800px){.shell-wrapper .shell-ml12-ml{margin-left:12px!important}.shell-wrapper .shell-py0-ml{padding-top:0!important;padding-bottom:0!important}.shell-wrapper .shell-py48-ml{padding-top:48px!important;padding-bottom:48px!important}}@media screen and (min-width:1200px){.shell-wrapper .shell-ml18-mxl{margin-left:18px!important}}.shell-wrapper .shell-transition{transition:all .125s}.shell-wrapper .shell-clip{overflow:hidden!important}@font-face{font-family:'Cera';font-weight:700;src:url(https://api.mapbox.com/mapbox-assembly/mbx/v0.14.0/CeraPRO-Bold.woff2) format('woff2'),url(https://api.mapbox.com/mapbox-assembly/mbx/v0.14.0/CeraPRO-Bold.woff) format('woff')}.shell-wrapper .shell-mb-logo{background-image:url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!-- 0) --%3E%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 101 22' style='enable-background:new 0 0 101 22;' xml:space='preserve'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23285EAA;%7D .st1%7Bfill:%2395BEFA;%7D .st2%7Bfill-rule:evenodd;clip-rule:evenodd;fill:%2395BEFA;%7D .st3%7Bfill-rule:evenodd;clip-rule:evenodd;fill:%23285EAA;%7D%0A%3C/style%3E%3Cpath class='st0' d='M30.6,10.5l-0.8-1.8l-0.4,1.8l-1.2,5.8h-1.9l2.6-12.5h0.3l3.4,6.8l1,2.3l1-2.3L38,3.8h0.2l2.7,12.5H39l-1.3-5.8 l-0.4-1.8l-0.7,1.8l-3,5.8h-0.1L30.6,10.5z'/%3E%3Cpath class='st0' d='M46,16.5c-0.7,0-1.4-0.2-2-0.5c-0.6-0.3-1.1-0.8-1.4-1.4c-0.4-0.6-0.5-1.4-0.5-2.2s0.2-1.5,0.5-2.1 c0.3-0.6,0.8-1.1,1.3-1.4c0.6-0.3,1.3-0.5,2-0.5c0.5,0,0.9,0.1,1.3,0.2c0.4,0.2,0.7,0.4,1,0.6c0.3,0.2,0.5,0.5,0.5,0.7V8.6h1.8v7.8 h-1.7V15c-0.2,0.4-0.5,0.8-1.1,1.1C47.2,16.4,46.6,16.5,46,16.5z M46.3,15c0.6,0,1.2-0.2,1.6-0.7c0.4-0.5,0.7-1,0.7-1.8v-0.1 c0-0.5-0.1-0.9-0.3-1.3c-0.2-0.4-0.5-0.7-0.8-0.9c-0.4-0.2-0.7-0.3-1.2-0.3c-0.7,0-1.3,0.2-1.7,0.7S44,11.7,44,12.4 c0,0.8,0.2,1.4,0.6,1.9C45,14.7,45.6,15,46.3,15z'/%3E%3Cpath class='st0' d='M53.1,8.5h1.8V10c0.6-1.1,1.6-1.7,2.9-1.7c1.1,0,2,0.4,2.7,1.1c0.7,0.7,1,1.7,1,3c0,0.8-0.2,1.5-0.5,2.2 c-0.3,0.6-0.8,1.1-1.4,1.4c-0.6,0.3-1.2,0.5-1.9,0.5s-1.2-0.1-1.7-0.3c-0.5-0.2-0.9-0.6-1.1-1v5.3h-1.8V8.5z M57.2,15 c0.7,0,1.3-0.2,1.7-0.7s0.6-1.1,0.6-1.8c0-0.8-0.2-1.4-0.6-1.8c-0.4-0.5-1-0.7-1.7-0.7c-0.4,0-0.8,0.1-1.2,0.3s-0.6,0.5-0.9,0.9 c-0.2,0.4-0.3,0.8-0.3,1.3v0.1c0,0.5,0.1,0.9,0.3,1.3c0.2,0.4,0.5,0.7,0.9,0.9C56.4,14.9,56.8,15,57.2,15z'/%3E%3Cpath class='st1' d='M63.5,3.8h1.9v10.8H69v1.7h-5.5V3.8z'/%3E%3Cpath class='st1' d='M70.8,8.5h1.9v7.8h-1.9V8.5z M71.8,7.1c-0.4,0-0.6-0.1-0.9-0.4c-0.2-0.2-0.4-0.5-0.4-0.9c0-0.3,0.1-0.6,0.4-0.8 c0.2-0.2,0.5-0.3,0.9-0.3c0.3,0,0.6,0.1,0.9,0.3s0.4,0.5,0.4,0.8c0,0.4-0.1,0.6-0.4,0.9C72.4,6.9,72.1,7.1,71.8,7.1z'/%3E%3Cpath class='st1' d='M79.9,16.5c-0.6,0-1.2-0.2-1.7-0.5c-0.5-0.3-0.8-0.7-1-1.1v1.4h-1.8V3.8h1.8v4.8L77.1,10 c0.2-0.5,0.6-0.8,1.1-1.2c0.6-0.3,1.2-0.5,1.8-0.5c0.8,0,1.4,0.2,2,0.5s1,0.8,1.3,1.4c0.3,0.6,0.5,1.3,0.5,2.1 c0,0.8-0.2,1.6-0.5,2.2c-0.4,0.6-0.8,1.1-1.4,1.4C81.3,16.4,80.6,16.5,79.9,16.5z M79.6,15c0.7,0,1.3-0.2,1.7-0.7 c0.4-0.5,0.6-1.1,0.6-1.8c0-0.8-0.2-1.4-0.6-1.8c-0.4-0.5-1-0.7-1.7-0.7c-0.6,0-1.2,0.2-1.6,0.7c-0.4,0.4-0.7,1-0.7,1.8v0.1 c0,0.5,0.1,0.9,0.3,1.3c0.2,0.4,0.5,0.7,0.8,0.9C78.8,14.9,79.2,15,79.6,15z'/%3E%3Cpath class='st1' d='M85.8,8.5h1.8V10c0.2-0.5,0.5-0.9,0.9-1.3c0.4-0.3,0.9-0.5,1.4-0.5c0.4,0,0.6,0,0.7,0.1l-0.3,1.9 c-0.1-0.1-0.3-0.1-0.7-0.1c-0.5,0-1,0.2-1.5,0.5c-0.4,0.3-0.6,0.9-0.6,1.6v4h-1.8L85.8,8.5L85.8,8.5z'/%3E%3Cpath class='st1' d='M95.6,16.5c-0.9,0-1.7-0.2-2.3-0.5c-0.6-0.4-1.1-0.9-1.4-1.5s-0.4-1.3-0.4-2c0-0.8,0.2-1.6,0.5-2.2 c0.4-0.6,0.8-1.1,1.4-1.4c0.6-0.3,1.3-0.5,2.1-0.5c1.2,0,2.1,0.3,2.7,1s0.9,1.6,0.9,2.8c0,0.3,0,0.6-0.1,1h-5.6 c0.1,0.7,0.4,1.2,0.7,1.5c0.4,0.3,0.9,0.5,1.6,0.5c0.5,0,1,0,1.3-0.1c0.4-0.1,0.7-0.2,1-0.4l0.6,1.3c-0.3,0.2-0.7,0.3-1.2,0.5 C96.9,16.4,96.3,16.5,95.6,16.5z M97.3,11.8c0-0.7-0.1-1.2-0.5-1.5C96.5,10,96,9.9,95.4,9.9c-1.2,0-1.9,0.6-2.1,1.9 C93.3,11.8,97.3,11.8,97.3,11.8z'/%3E%3Cg%3E%3Cpath class='st2' d='M10.6,6.8c0-2.9,2.6-5.3,5.6-5.3s5.6,2.4,5.6,5.3c0,4.3-4.6,8-5.3,8.5c-0.1,0-0.1,0.1-0.1,0.1 c-0.1,0.1-0.2,0.1-0.2,0.1s-0.2,0-0.2-0.1c0,0,0,0-0.1-0.1C15.2,14.8,10.6,11.2,10.6,6.8z M16.1,9.9c1.5,0,2.7-1.2,2.7-2.8 s-1.2-2.8-2.7-2.8S13.4,5.5,13.4,7S14.6,9.9,16.1,9.9z'/%3E%3Cpath class='st3' d='M13.1,16.3c-0.4,0-0.7,0.4-0.7,0.7v2.1c0,0.4,0.4,0.7,0.7,0.7h6.3c0.4,0,0.7-0.4,0.7-0.7V17 c0-0.4-0.4-0.7-0.7-0.7H13.1z M18.5,17.6h-4.7v1h4.7V17.6z'/%3E%3C/g%3E%3C/svg%3E%0A");background-size:115px 36px;background-repeat:no-repeat;display:inline-block;width:115px;height:36px}@media screen and (min-width:800px){.shell-wrapper .shell-mb-logo{background-size:132px 42px;width:132px;height:42px}}.shell-wrapper .shell-mb-logo__wrapper{height:42px}.shell-wrapper .shell-color-blue{color:#4264fb!important}.shell-wrapper .shell-color-gray{color:#5b7897!important}.shell-wrapper .shell-color-white{color:#fff!important}.shell-wrapper .shell-color-pink{color:#ed6498!important}.shell-wrapper .shell-bg-blue{background-color:#4264fb!important}.shell-wrapper .shell-bg-white{background-color:#fff!important}.shell-wrapper .shell-bg-pink{background-color:#ed6498!important}.shell-wrapper .shell-border--gray-light{border-color:#c6d2e1!important}.shell-wrapper .shell-shadow-darken10-bold{box-shadow:0 0 30px 6px rgba(31,51,73,.1)!important}.shell-wrapper .shell-color-blue-dark-on-hover:hover{color:#314ccd!important}.shell-wrapper .shell-color-gray-dark-on-hover:hover{color:#23374d!important}.shell-header-buffer{padding-top:66px}@media (min-width:640px){.shell-header-buffer{padding-top:84px}}.shell-animated-menu,.shell-mobile-nav__backdrop{transition:opacity .25s,visibility .25s,transform .25s,-webkit-transform .25s}.shell-mobile-nav__backdrop{will-change:opacity}.shell-animated-menu{pointer-events:none;-webkit-transform:translate(0,0,0) scale(.95);transform:translate(0,0,0) scale(.95);-webkit-transform-origin:50% 0;transform-origin:50% 0}.shell-animated-menu,.shell-mobile-nav__backdrop{opacity:0;visibility:hidden}.shell-mobile-nav__trigger__bar--bottom,.shell-mobile-nav__trigger__bar--middle,.shell-mobile-nav__trigger__bar--top{opacity:1;transition:opacity .25s,transform .25s;transition:opacity .25s,transform .25s,-webkit-transform .25s;-webkit-transform:translateY(0) rotate(0deg) scale(1);transform:translateY(0) rotate(0deg) scale(1)}.shell-mobile-nav__trigger__bar--middle{-webkit-transform-origin:9px 9px;transform-origin:9px 9px}.shell-mobile-nav__trigger__bar--top{-webkit-transform-origin:9px 5px;transform-origin:9px 5px}.shell-mobile-nav__trigger__bar--bottom{-webkit-transform-origin:9px 13px;transform-origin:9px 13px}
/*# sourceMappingURL=batfish-styles-2a909899880b19d5ebd0eeb5b04149c2.css.map */</style>
<script id="loadCss">document.addEventListener('DOMContentLoaded',function(){var s=document.createElement('link');s.rel='stylesheet';s.href='/maplibre-gl-js-docs/assets/batfish-styles-2a909899880b19d5ebd0eeb5b04149c2.css';document.head.insertBefore(s, document.getElementById('loadCss'));});</script>
</head><body><div id="batfish-content"><div id="page-shell" data-reactroot=""><div class="shell-wrapper" id="page-shell-compatibility-warning" style="display:none" data-swiftype-index="false"><div class="shell-py12 shell-px24 shell-bg-pink shell-color-white shell-align-l"><button class="shell-absolute shell-top shell-right shell-p12" id="page-shell-compatibility-dismiss"><svg class="shell-icon" viewBox="0 0 18 18"><path d="M5.8,5C5.4,5,5,5.4,5,5.8C5,6,5.1,6.2,5.3,6.3l0,0L7.9,9l-2.6,2.6C5.1,11.8,5,12,5,12.2C5,12.6,5.4,13,5.8,13 c0.2,0,0.4-0.1,0.6-0.3L9,10.1l2.6,2.6c0.1,0.2,0.4,0.3,0.6,0.3c0.4,0,0.8-0.4,0.8-0.8c0-0.2-0.1-0.4-0.2-0.6L10.1,9l2.6-2.7 C12.9,6.2,13,6,13,5.8C13,5.4,12.6,5,12.2,5c-0.2,0-0.4,0.1-0.6,0.2L9,7.8L6.4,5.2C6.2,5.1,6,5,5.8,5L5.8,5z"></path></svg></button><div class="limiter shell-block shell-relative"><div class="compatibility-warning-copy shell-mb6 shell-mb0-mm shell-align-center shell-align-l-mm shell-txt-bold">You are using an outdated browser and will encounter some problems with our website. Please consider upgrading.</div><div class="compatibility-warning-action shell-align-center"><a class="shell-btn shell-btn--white shell-color-pink shell-txt-nowrap" href="http://outdatedbrowser.com">Upgrade Now</a></div></div></div></div><div class="shell-flex-parent shell-flex-parent--column" style="min-height:100vh"><div class="shell-flex-child shell-flex-child--grow shell-flex-child--no-shrink"><div class="shell-wrapper"><header class="shell-absolute shell-w-full shell-z1" data-swiftype-index="false"><div class="shell-none limiter limiter--wide shell-mt24 shell-flex-parent-mm shell-flex-parent--center-cross"><div class="shell-flex-parent shell-flex-parent--center-cross"><a href="https://www.maplibre.org" aria-label="MapLibre" class="shell-flex-child shell-mb-logo"></a><div class="shell-flex-child shell-h24 shell-mx12 shell-bg-blue" style="width:2px" data-subtitle-bar-dark="true"></div><a href="https://maplibre.org/maplibre-gl-js-docs" class="shell-flex-child shell-txt-bold shell-txt-l  shell-color-blue shell-color-blue-dark-on-hover" style="margin-bottom:2px" data-subtitle-dark="true">Docs</a></div><div class="shell-flex-child shell-flex-child--grow shell-flex-parent shell-flex-parent--center-cross shell-flex-parent--end-main"><div class="shell-flex-parent shell-flex-parent--center-cross shell-flex-parent--end-main"></div></div><div class="shell-flex-child shell-ml6 shell-ml12-ml shell-ml18-mxl"></div></div><div id="page-header-content" class="shell-none-mm limiter shell-py12 shell-z2 shell-relative"><div class="shell-flex-parent shell-flex-parent--center-cross"><div class="shell-flex-child shell-flex-child--no-shrink shell-ml-neg6"><button id="mobile-nav-trigger-toggle" aria-label="Toggle navigation" class="shell-block shell-color-blue" data-test="mobile-nav-trigger-toggle"><svg id="mobile-nav-trigger-menu" viewBox="0 0 18 18" class="shell-mobile-nav__trigger shell-icon shell-transition shell-icon--l"><g><path class="shell-mobile-nav__trigger__bar--top" d="M4.2,6h9.6C14.5,6,15,5.6,15,5s-0.5-1-1.2-1H4.2C3.5,4,3,4.4,3,5S3.5,6,4.2,6z"></path><path class="shell-mobile-nav__trigger__bar--middle" d="M13.8,8H4.2C3.5,8,3,8.4,3,9s0.5,1,1.2,1h9.6c0.7,0,1.2-0.4,1.2-1S14.5,8,13.8,8z"></path><path class="shell-mobile-nav__trigger__bar--bottom" d="M13.8,12H4.2C3.5,12,3,12.4,3,13s0.5,1,1.2,1h9.6c0.7,0,1.2-0.4,1.2-1S14.5,12,13.8,12z"></path></g></svg></button></div><div class="shell-flex-child shell-flex-child--grow shell-relative shell-mb-logo__wrapper shell-ml12"><div class="shell-flex-parent shell-flex-parent--center-cross"><a href="https://www.maplibre.org" aria-label="MapLibre" class="shell-flex-child shell-mb-logo" style="width:30px;height:42px;background-size:132px 42px"></a><a href="https://maplibre.org/maplibre-gl-js-docs" class="shell-flex-child shell-txt-bold shell-txt-l  shell-color-blue shell-color-blue-dark-on-hover shell-ml6" style="margin-bottom:2px" data-subtitle-dark="true">Docs</a></div></div><div class="shell-flex-child shell-flex-child--no-shrink"></div></div></div><div class="shell-z1 shell-absolute shell-top shell-left shell-right shell-w-full"><div id="mobile-nav-backdrop" data-test="mobile-nav-backdrop" class="shell-absolute shell-bottom shell-left shell-right shell-mobile-nav__backdrop" style="top:72px;background-image:linear-gradient(to bottom, transparent, rgba(31, 51, 73, .5))"></div><div id="mobile-nav-menu" data-test="mobile-nav-menu" class="shell-absolute shell-z5 shell-w-full shell-animated-menu" style="top:0;right:0"><div class="shell-shadow-darken10-bold shell-bg-white shell-clip shell-px24" style="padding-top:72px"><div class="shell-pb24"></div><div class="shell-border-t shell-border--gray-light shell-py24"><a href="https://maplibre.org/maplibre-gl-js-docs" class="shell-color-blue">MapLibre</a></div></div></div></div></header></div><main role="main" style="z-index:0;position:relative;display:block"><div class="shell-header-buffer"></div><div class="limiter limiter--wide"><div class="flex-parent-mm"><div class="flex-child flex-child--no-shrink w-full w180-mm w240-ml mr36-mm undefined" style="width:100%"><div data-swiftype-index="false" id="dr-ui--page-layout-sidebar" class="sticky-mm scroll-auto-mm scroll-styled viewport-almost-mm px12-mm" style="top:10px"><div class="mb6 border-b border--darken10"><div class="mb6"><div class="dr-ui--product-menu"><a href="/maplibre-gl-js-docs/" class="txt-fancy txt-l block color-blue-on-hover">MapLibre GL JS Docs</a></div></div></div><div class=""><nav class="mx-neg12"><ul><li><div class="px12 flex-parent txt-uppercase txt-fancy round-full w-full color-darken75 flex-parent flex-parent--space-between-main"><a href="/maplibre-gl-js-docs/api/" class="flex-child flex-child--grow  color-blue-on-hover py6 py3-mm" style="letter-spacing:0.025em">API Reference</a><button class="flex-child flex-child--no-shrink color-blue-on-hover px12 px0-mm" aria-label="Toggle API Reference menu" aria-controls="menu-api-reference" aria-expanded="false"><svg role="presentation" focusable="false" class="events-none icon inline-block align-t" style="width:18px;height:18px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-chevron-down"></use></svg></button></div></li><li><div class="px12 flex-parent txt-uppercase txt-fancy round-full w-full color-darken75 bg-blue-faint color-blue"><a href="/maplibre-gl-js-docs/example/" class="flex-child flex-child--grow  color-blue-on-hover py6 py3-mm" style="letter-spacing:0.025em">Examples</a></div></li><li><div class="px12 flex-parent txt-uppercase txt-fancy round-full w-full color-darken75"><a href="/maplibre-gl-js-docs/plugins/" class="flex-child flex-child--grow  color-blue-on-hover py6 py3-mm" style="letter-spacing:0.025em">Plugins</a></div></li><li><div class="px12 flex-parent txt-uppercase txt-fancy round-full w-full color-darken75"><a href="https://maplibre.org/maplibre-style-spec/" class="flex-child flex-child--grow  color-blue-on-hover py6 py3-mm" style="letter-spacing:0.025em">Style Specification<span class="ml3 color-darken50 relative" style="top:-1px"><svg role="presentation" focusable="false" class="events-none icon inline-block align-t" style="width:18px;height:18px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-share"></use></svg></span></a></div></li></ul></nav></div></div></div><div class="flex-child flex-child--grow" style="width:100%"><div class="dr-ui--breadcrumb pt3 pb12 none block-mm" data-swiftype-index="false"><span class="none inline-block-mm"><a class="link" href="https://maplibre.org/">MapLibre</a><span class="color-gray-light inline-block-mm none px6"><svg role="presentation" focusable="false" class="events-none icon inline-block align-t" style="width:18px;height:18px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-chevron-right"></use></svg></span></span><span class="none inline-block-mm"><a class="link" href="/maplibre-gl-js-docs/">MapLibre GL JS Docs</a><span class="color-gray-light inline-block-mm none px6"><svg role="presentation" focusable="false" class="events-none icon inline-block align-t" style="width:18px;height:18px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-chevron-right"></use></svg></span></span><span class=""><span class="color-gray-light inline-block none-mm pr6"><svg role="presentation" focusable="false" class="events-none icon inline-block align-t" style="width:18px;height:18px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-arrow-left"></use></svg></span><a class="link" href="/maplibre-gl-js-docs/example/">Examples</a><span class="color-gray-light inline-block-mm none px6"><svg role="presentation" focusable="false" class="events-none icon inline-block align-t" style="width:18px;height:18px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-chevron-right"></use></svg></span></span><span class="color-gray none inline-block-mm">Display HTML clusters with custom properties</span></div><div id="docs-content"><div class="col prose col--8-mxl col--12"><h1 class="txt-fancy">Display HTML clusters with custom properties</h1></div><div class="grid grid--gut60"><div class="dr-ui--page-layout-aside col col--12 col--4-mxl"><aside data-swiftype-index="false" class="scroll-auto-mxl scroll-styled viewport-almost-mxl sticky-mxl" style="top:10px"></aside></div><div class="col col--8-mxl col--12 prose"><div><div><p>This advanced example uses MapLibre GL JS clustering with HTML markers and custom property expressions. To use HTML or SVG for clusters in place of a MapLibre GL layer, you have to manually synchronize the clustered source with a pool of marker objects that updates continuously while the map view changes.</p><div class="prose"><div class="bg-white"><div id="code" class="relative"><div data-swiftype-index="false"><div class="relative prose"><div class="absolute-mm mb6 mb0-mm top right mr36-mm z2" style="margin-top:4px"><form class="inline-block" method="POST" action="https://jsfiddle.net/api/post/library/pure/" target="_blank"><input type="submit" style="border:0" class="btn btn--s cursor-pointer round" value="Edit in JSFiddle"/><input type="hidden" name="wrap" value="b"/><input type="hidden" name="css" value="
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
"/><input type="hidden" name="html" value="
&lt;div id=&quot;map&quot;&gt;&lt;/div&gt;



"/><input type="hidden" name="js" value="
    var map = new maplibregl.Map({
        container: &#x27;map&#x27;,
        zoom: 0.3,
        center: [0, 20],
        style:
            &#x27;https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL&#x27;
    });

    map.addControl(new maplibregl.NavigationControl());

    // filters for classifying earthquakes into five categories based on magnitude
    var mag1 = [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 2];
    var mag2 = [&#x27;all&#x27;, [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 2], [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 3]];
    var mag3 = [&#x27;all&#x27;, [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 3], [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 4]];
    var mag4 = [&#x27;all&#x27;, [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 4], [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 5]];
    var mag5 = [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 5];

    // colors to use for the categories
    var colors = [&#x27;#fed976&#x27;, &#x27;#feb24c&#x27;, &#x27;#fd8d3c&#x27;, &#x27;#fc4e2a&#x27;, &#x27;#e31a1c&#x27;];

    map.on(&#x27;load&#x27;, function () {
        // add a clustered GeoJSON source for a sample set of earthquakes
        map.addSource(&#x27;earthquakes&#x27;, {
            &#x27;type&#x27;: &#x27;geojson&#x27;,
            &#x27;data&#x27;:
                &#x27;https://maplibre.org/maplibre-gl-js-docs/assets/earthquakes.geojson&#x27;,
            &#x27;cluster&#x27;: true,
            &#x27;clusterRadius&#x27;: 80,
            &#x27;clusterProperties&#x27;: {
                // keep separate counts for each magnitude category in a cluster
                &#x27;mag1&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag1, 1, 0]],
                &#x27;mag2&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag2, 1, 0]],
                &#x27;mag3&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag3, 1, 0]],
                &#x27;mag4&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag4, 1, 0]],
                &#x27;mag5&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag5, 1, 0]]
            }
        });
        // circle and symbol layers for rendering individual earthquakes (unclustered points)
        map.addLayer({
            &#x27;id&#x27;: &#x27;earthquake_circle&#x27;,
            &#x27;type&#x27;: &#x27;circle&#x27;,
            &#x27;source&#x27;: &#x27;earthquakes&#x27;,
            &#x27;filter&#x27;: [&#x27;!=&#x27;, &#x27;cluster&#x27;, true],
            &#x27;paint&#x27;: {
                &#x27;circle-color&#x27;: [
                    &#x27;case&#x27;,
                    mag1,
                    colors[0],
                    mag2,
                    colors[1],
                    mag3,
                    colors[2],
                    mag4,
                    colors[3],
                    colors[4]
                ],
                &#x27;circle-opacity&#x27;: 0.6,
                &#x27;circle-radius&#x27;: 12
            }
        });
        map.addLayer({
            &#x27;id&#x27;: &#x27;earthquake_label&#x27;,
            &#x27;type&#x27;: &#x27;symbol&#x27;,
            &#x27;source&#x27;: &#x27;earthquakes&#x27;,
            &#x27;filter&#x27;: [&#x27;!=&#x27;, &#x27;cluster&#x27;, true],
            &#x27;layout&#x27;: {
                &#x27;text-field&#x27;: [
                    &#x27;number-format&#x27;,
                    [&#x27;get&#x27;, &#x27;mag&#x27;],
                    { &#x27;min-fraction-digits&#x27;: 1, &#x27;max-fraction-digits&#x27;: 1 }
                ],
                &#x27;text-font&#x27;: [&#x27;Open Sans Semibold&#x27;, &#x27;Arial Unicode MS Bold&#x27;],
                &#x27;text-size&#x27;: 10
            },
            &#x27;paint&#x27;: {
                &#x27;text-color&#x27;: [
                    &#x27;case&#x27;,
                    [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 3],
                    &#x27;black&#x27;,
                    &#x27;white&#x27;
                ]
            }
        });

        // objects for caching and keeping track of HTML marker objects (for performance)
        var markers = {};
        var markersOnScreen = {};

        function updateMarkers() {
            var newMarkers = {};
            var features = map.querySourceFeatures(&#x27;earthquakes&#x27;);

            // for every cluster on the screen, create an HTML marker for it (if we didn&#x27;t yet),
            // and add it to the map if it&#x27;s not there already
            for (var i = 0; i &lt; features.length; i++) {
                var coords = features[i].geometry.coordinates;
                var props = features[i].properties;
                if (!props.cluster) continue;
                var id = props.cluster_id;

                var marker = markers[id];
                if (!marker) {
                    var el = createDonutChart(props);
                    marker = markers[id] = new maplibregl.Marker({
                        element: el
                    }).setLngLat(coords);
                }
                newMarkers[id] = marker;

                if (!markersOnScreen[id]) marker.addTo(map);
            }
            // for every marker we&#x27;ve added previously, remove those that are no longer visible
            for (id in markersOnScreen) {
                if (!newMarkers[id]) markersOnScreen[id].remove();
            }
            markersOnScreen = newMarkers;
        }

        // after the GeoJSON data is loaded, update markers on the screen and do so on every map move/moveend
        map.on(&#x27;data&#x27;, function (e) {
            if (e.sourceId !== &#x27;earthquakes&#x27; || !e.isSourceLoaded) return;

            map.on(&#x27;move&#x27;, updateMarkers);
            map.on(&#x27;moveend&#x27;, updateMarkers);
            updateMarkers();
        });
    });

    // code for creating an SVG donut chart from feature properties
    function createDonutChart(props) {
        var offsets = [];
        var counts = [
            props.mag1,
            props.mag2,
            props.mag3,
            props.mag4,
            props.mag5
        ];
        var total = 0;
        for (var i = 0; i &lt; counts.length; i++) {
            offsets.push(total);
            total += counts[i];
        }
        var fontSize =
            total &gt;= 1000 ? 22 : total &gt;= 100 ? 20 : total &gt;= 10 ? 18 : 16;
        var r = total &gt;= 1000 ? 50 : total &gt;= 100 ? 32 : total &gt;= 10 ? 24 : 18;
        var r0 = Math.round(r * 0.6);
        var w = r * 2;

        var html =
            &#x27;&lt;div&gt;&lt;svg width=&quot;&#x27; +
            w +
            &#x27;&quot; height=&quot;&#x27; +
            w +
            &#x27;&quot; viewbox=&quot;0 0 &#x27; +
            w +
            &#x27; &#x27; +
            w +
            &#x27;&quot; text-anchor=&quot;middle&quot; style=&quot;font: &#x27; +
            fontSize +
            &#x27;px sans-serif; display: block&quot;&gt;&#x27;;

        for (i = 0; i &lt; counts.length; i++) {
            html += donutSegment(
                offsets[i] / total,
                (offsets[i] + counts[i]) / total,
                r,
                r0,
                colors[i]
            );
        }
        html +=
            &#x27;&lt;circle cx=&quot;&#x27; +
            r +
            &#x27;&quot; cy=&quot;&#x27; +
            r +
            &#x27;&quot; r=&quot;&#x27; +
            r0 +
            &#x27;&quot; fill=&quot;white&quot; /&gt;&lt;text dominant-baseline=&quot;central&quot; transform=&quot;translate(&#x27; +
            r +
            &#x27;, &#x27; +
            r +
            &#x27;)&quot;&gt;&#x27; +
            total.toLocaleString() +
            &#x27;&lt;/text&gt;&lt;/svg&gt;&lt;/div&gt;&#x27;;

        var el = document.createElement(&#x27;div&#x27;);
        el.innerHTML = html;
        return el.firstChild;
    }

    function donutSegment(start, end, r, r0, color) {
        if (end - start === 1) end -= 0.00001;
        var a0 = 2 * Math.PI * (start - 0.25);
        var a1 = 2 * Math.PI * (end - 0.25);
        var x0 = Math.cos(a0),
            y0 = Math.sin(a0);
        var x1 = Math.cos(a1),
            y1 = Math.sin(a1);
        var largeArc = end - start &gt; 0.5 ? 1 : 0;

        return [
            &#x27;&lt;path d=&quot;M&#x27;,
            r + r0 * x0,
            r + r0 * y0,
            &#x27;L&#x27;,
            r + r * x0,
            r + r * y0,
            &#x27;A&#x27;,
            r,
            r,
            0,
            largeArc,
            1,
            r + r * x1,
            r + r * y1,
            &#x27;L&#x27;,
            r + r0 * x1,
            r + r0 * y1,
            &#x27;A&#x27;,
            r0,
            r0,
            0,
            largeArc,
            0,
            r + r0 * x0,
            r + r0 * y0,
            &#x27;&quot; fill=&quot;&#x27; + color + &#x27;&quot; /&gt;&#x27;
        ].join(&#x27; &#x27;);
    }
"/><input type="hidden" name="title" value="Display HTML clusters with custom properties"/><input type="hidden" name="resources" value="https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.js,https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.css"/><input type="hidden" name="description" value="Extend clustering with HTML markers and custom property expressions.

See the example: https://docs.mapbox.com//maplibre-gl-js-docs/example/cluster-html/"/></form><form class="inline-block ml6" method="POST" action="https://codepen.io/pen/define" target="_blank"><input type="hidden" name="data" value="{&quot;title&quot;:&quot;Display HTML clusters with custom properties&quot;,&quot;html&quot;:&quot;\n&lt;div id=\&quot;map\&quot;&gt;&lt;/div&gt;\n\n\n\n&quot;,&quot;html_pre_processor&quot;:&quot;none&quot;,&quot;description&quot;:&quot;Extend clustering with HTML markers and custom property expressions.\n\nSee the example: [https://docs.mapbox.com//maplibre-gl-js-docs/example/cluster-html/](https://docs.mapbox.com//maplibre-gl-js-docs/example/cluster-html/)&quot;,&quot;tags&quot;:[&quot;mapbox&quot;,&quot;maps&quot;],&quot;css&quot;:&quot;\n\tbody { margin: 0; padding: 0; }\n\t#map { position: absolute; top: 0; bottom: 0; width: 100%; }\n&quot;,&quot;css_pre_processor&quot;:&quot;none&quot;,&quot;js&quot;:&quot;\n    var map = new maplibregl.Map({\n        container: &#x27;map&#x27;,\n        zoom: 0.3,\n        center: [0, 20],\n        style:\n            &#x27;https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL&#x27;\n    });\n\n    map.addControl(new maplibregl.NavigationControl());\n\n    // filters for classifying earthquakes into five categories based on magnitude\n    var mag1 = [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 2];\n    var mag2 = [&#x27;all&#x27;, [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 2], [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 3]];\n    var mag3 = [&#x27;all&#x27;, [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 3], [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 4]];\n    var mag4 = [&#x27;all&#x27;, [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 4], [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 5]];\n    var mag5 = [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 5];\n\n    // colors to use for the categories\n    var colors = [&#x27;#fed976&#x27;, &#x27;#feb24c&#x27;, &#x27;#fd8d3c&#x27;, &#x27;#fc4e2a&#x27;, &#x27;#e31a1c&#x27;];\n\n    map.on(&#x27;load&#x27;, function () {\n        // add a clustered GeoJSON source for a sample set of earthquakes\n        map.addSource(&#x27;earthquakes&#x27;, {\n            &#x27;type&#x27;: &#x27;geojson&#x27;,\n            &#x27;data&#x27;:\n                &#x27;https://maplibre.org/maplibre-gl-js-docs/assets/earthquakes.geojson&#x27;,\n            &#x27;cluster&#x27;: true,\n            &#x27;clusterRadius&#x27;: 80,\n            &#x27;clusterProperties&#x27;: {\n                // keep separate counts for each magnitude category in a cluster\n                &#x27;mag1&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag1, 1, 0]],\n                &#x27;mag2&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag2, 1, 0]],\n                &#x27;mag3&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag3, 1, 0]],\n                &#x27;mag4&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag4, 1, 0]],\n                &#x27;mag5&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag5, 1, 0]]\n            }\n        });\n        // circle and symbol layers for rendering individual earthquakes (unclustered points)\n        map.addLayer({\n            &#x27;id&#x27;: &#x27;earthquake_circle&#x27;,\n            &#x27;type&#x27;: &#x27;circle&#x27;,\n            &#x27;source&#x27;: &#x27;earthquakes&#x27;,\n            &#x27;filter&#x27;: [&#x27;!=&#x27;, &#x27;cluster&#x27;, true],\n            &#x27;paint&#x27;: {\n                &#x27;circle-color&#x27;: [\n                    &#x27;case&#x27;,\n                    mag1,\n                    colors[0],\n                    mag2,\n                    colors[1],\n                    mag3,\n                    colors[2],\n                    mag4,\n                    colors[3],\n                    colors[4]\n                ],\n                &#x27;circle-opacity&#x27;: 0.6,\n                &#x27;circle-radius&#x27;: 12\n            }\n        });\n        map.addLayer({\n            &#x27;id&#x27;: &#x27;earthquake_label&#x27;,\n            &#x27;type&#x27;: &#x27;symbol&#x27;,\n            &#x27;source&#x27;: &#x27;earthquakes&#x27;,\n            &#x27;filter&#x27;: [&#x27;!=&#x27;, &#x27;cluster&#x27;, true],\n            &#x27;layout&#x27;: {\n                &#x27;text-field&#x27;: [\n                    &#x27;number-format&#x27;,\n                    [&#x27;get&#x27;, &#x27;mag&#x27;],\n                    { &#x27;min-fraction-digits&#x27;: 1, &#x27;max-fraction-digits&#x27;: 1 }\n                ],\n                &#x27;text-font&#x27;: [&#x27;Open Sans Semibold&#x27;, &#x27;Arial Unicode MS Bold&#x27;],\n                &#x27;text-size&#x27;: 10\n            },\n            &#x27;paint&#x27;: {\n                &#x27;text-color&#x27;: [\n                    &#x27;case&#x27;,\n                    [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 3],\n                    &#x27;black&#x27;,\n                    &#x27;white&#x27;\n                ]\n            }\n        });\n\n        // objects for caching and keeping track of HTML marker objects (for performance)\n        var markers = {};\n        var markersOnScreen = {};\n\n        function updateMarkers() {\n            var newMarkers = {};\n            var features = map.querySourceFeatures(&#x27;earthquakes&#x27;);\n\n            // for every cluster on the screen, create an HTML marker for it (if we didn&#x27;t yet),\n            // and add it to the map if it&#x27;s not there already\n            for (var i = 0; i &lt; features.length; i++) {\n                var coords = features[i].geometry.coordinates;\n                var props = features[i].properties;\n                if (!props.cluster) continue;\n                var id = props.cluster_id;\n\n                var marker = markers[id];\n                if (!marker) {\n                    var el = createDonutChart(props);\n                    marker = markers[id] = new maplibregl.Marker({\n                        element: el\n                    }).setLngLat(coords);\n                }\n                newMarkers[id] = marker;\n\n                if (!markersOnScreen[id]) marker.addTo(map);\n            }\n            // for every marker we&#x27;ve added previously, remove those that are no longer visible\n            for (id in markersOnScreen) {\n                if (!newMarkers[id]) markersOnScreen[id].remove();\n            }\n            markersOnScreen = newMarkers;\n        }\n\n        // after the GeoJSON data is loaded, update markers on the screen and do so on every map move/moveend\n        map.on(&#x27;data&#x27;, function (e) {\n            if (e.sourceId !== &#x27;earthquakes&#x27; || !e.isSourceLoaded) return;\n\n            map.on(&#x27;move&#x27;, updateMarkers);\n            map.on(&#x27;moveend&#x27;, updateMarkers);\n            updateMarkers();\n        });\n    });\n\n    // code for creating an SVG donut chart from feature properties\n    function createDonutChart(props) {\n        var offsets = [];\n        var counts = [\n            props.mag1,\n            props.mag2,\n            props.mag3,\n            props.mag4,\n            props.mag5\n        ];\n        var total = 0;\n        for (var i = 0; i &lt; counts.length; i++) {\n            offsets.push(total);\n            total += counts[i];\n        }\n        var fontSize =\n            total &gt;= 1000 ? 22 : total &gt;= 100 ? 20 : total &gt;= 10 ? 18 : 16;\n        var r = total &gt;= 1000 ? 50 : total &gt;= 100 ? 32 : total &gt;= 10 ? 24 : 18;\n        var r0 = Math.round(r * 0.6);\n        var w = r * 2;\n\n        var html =\n            &#x27;&lt;div&gt;&lt;svg width=\&quot;&#x27; +\n            w +\n            &#x27;\&quot; height=\&quot;&#x27; +\n            w +\n            &#x27;\&quot; viewbox=\&quot;0 0 &#x27; +\n            w +\n            &#x27; &#x27; +\n            w +\n            &#x27;\&quot; text-anchor=\&quot;middle\&quot; style=\&quot;font: &#x27; +\n            fontSize +\n            &#x27;px sans-serif; display: block\&quot;&gt;&#x27;;\n\n        for (i = 0; i &lt; counts.length; i++) {\n            html += donutSegment(\n                offsets[i] / total,\n                (offsets[i] + counts[i]) / total,\n                r,\n                r0,\n                colors[i]\n            );\n        }\n        html +=\n            &#x27;&lt;circle cx=\&quot;&#x27; +\n            r +\n            &#x27;\&quot; cy=\&quot;&#x27; +\n            r +\n            &#x27;\&quot; r=\&quot;&#x27; +\n            r0 +\n            &#x27;\&quot; fill=\&quot;white\&quot; /&gt;&lt;text dominant-baseline=\&quot;central\&quot; transform=\&quot;translate(&#x27; +\n            r +\n            &#x27;, &#x27; +\n            r +\n            &#x27;)\&quot;&gt;&#x27; +\n            total.toLocaleString() +\n            &#x27;&lt;/text&gt;&lt;/svg&gt;&lt;/div&gt;&#x27;;\n\n        var el = document.createElement(&#x27;div&#x27;);\n        el.innerHTML = html;\n        return el.firstChild;\n    }\n\n    function donutSegment(start, end, r, r0, color) {\n        if (end - start === 1) end -= 0.00001;\n        var a0 = 2 * Math.PI * (start - 0.25);\n        var a1 = 2 * Math.PI * (end - 0.25);\n        var x0 = Math.cos(a0),\n            y0 = Math.sin(a0);\n        var x1 = Math.cos(a1),\n            y1 = Math.sin(a1);\n        var largeArc = end - start &gt; 0.5 ? 1 : 0;\n\n        return [\n            &#x27;&lt;path d=\&quot;M&#x27;,\n            r + r0 * x0,\n            r + r0 * y0,\n            &#x27;L&#x27;,\n            r + r * x0,\n            r + r * y0,\n            &#x27;A&#x27;,\n            r,\n            r,\n            0,\n            largeArc,\n            1,\n            r + r * x1,\n            r + r * y1,\n            &#x27;L&#x27;,\n            r + r0 * x1,\n            r + r0 * y1,\n            &#x27;A&#x27;,\n            r0,\n            r0,\n            0,\n            largeArc,\n            0,\n            r + r0 * x0,\n            r + r0 * y0,\n            &#x27;\&quot; fill=\&quot;&#x27; + color + &#x27;\&quot; /&gt;&#x27;\n        ].join(&#x27; &#x27;);\n    }\n&quot;,&quot;js_pre_processor&quot;:&quot;none&quot;,&quot;css_external&quot;:&quot;https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.css&quot;,&quot;js_external&quot;:&quot;https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.js&quot;,&quot;head&quot;:&quot;&lt;meta name=\&quot;viewport\&quot; content=\&quot;initial-scale=1,maximum-scale=1,user-scalable=no\&quot; /&gt;&quot;}"/><input type="submit" style="border:0" class="btn btn--s cursor-pointer round" value="Edit in CodePen"/></form></div><div class="relative round z0 scroll-styled"><pre><code class="px0 hljs"><div class="relative z2" data-chunk-code="chunk-0"><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Display HTML clusters with custom properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>initial-scale=1,maximum-scale=1,user-scalable=no<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px">	<span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px">	<span class="token selector">#map</span> <span class="token punctuation">{</span> <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span> <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> <span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">maplibregl<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">'map'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token literal-property property">style</span><span class="token operator">:</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL'</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px">map<span class="token punctuation">.</span><span class="token function">addControl</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">maplibregl<span class="token punctuation">.</span>NavigationControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// filters for classifying earthquakes into five categories based on magnitude</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> mag1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'mag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> mag2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'>='</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'mag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'mag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> mag3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'>='</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'mag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'mag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> mag4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'>='</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'mag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'mag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> mag5 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'>='</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'mag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// colors to use for the categories</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'#fed976'</span><span class="token punctuation">,</span> <span class="token string">'#feb24c'</span><span class="token punctuation">,</span> <span class="token string">'#fd8d3c'</span><span class="token punctuation">,</span> <span class="token string">'#fc4e2a'</span><span class="token punctuation">,</span> <span class="token string">'#e31a1c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px">map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// add a clustered GeoJSON source for a sample set of earthquakes</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px">map<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span><span class="token string">'earthquakes'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'type'</span><span class="token operator">:</span> <span class="token string">'geojson'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'data'</span><span class="token operator">:</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'https://maplibre.org/maplibre-gl-js-docs/assets/earthquakes.geojson'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'cluster'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'clusterRadius'</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'clusterProperties'</span><span class="token operator">:</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// keep separate counts for each magnitude category in a cluster</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'mag1'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'case'</span><span class="token punctuation">,</span> mag1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'mag2'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'case'</span><span class="token punctuation">,</span> mag2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'mag3'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'case'</span><span class="token punctuation">,</span> mag3<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'mag4'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'case'</span><span class="token punctuation">,</span> mag4<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'mag5'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'case'</span><span class="token punctuation">,</span> mag5<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// circle and symbol layers for rendering individual earthquakes (unclustered points)</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px">map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'id'</span><span class="token operator">:</span> <span class="token string">'earthquake_circle'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'type'</span><span class="token operator">:</span> <span class="token string">'circle'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'source'</span><span class="token operator">:</span> <span class="token string">'earthquakes'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'filter'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'!='</span><span class="token punctuation">,</span> <span class="token string">'cluster'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'paint'</span><span class="token operator">:</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'circle-color'</span><span class="token operator">:</span> <span class="token punctuation">[</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'case'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px">mag1<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px">colors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px">mag2<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px">colors<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px">mag3<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px">colors<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px">mag4<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px">colors<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px">colors<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'circle-opacity'</span><span class="token operator">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'circle-radius'</span><span class="token operator">:</span> <span class="token number">12</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px">map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'id'</span><span class="token operator">:</span> <span class="token string">'earthquake_label'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'type'</span><span class="token operator">:</span> <span class="token string">'symbol'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'source'</span><span class="token operator">:</span> <span class="token string">'earthquakes'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'filter'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'!='</span><span class="token punctuation">,</span> <span class="token string">'cluster'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'layout'</span><span class="token operator">:</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'text-field'</span><span class="token operator">:</span> <span class="token punctuation">[</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'number-format'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'mag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">{</span> <span class="token string-property property">'min-fraction-digits'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-property property">'max-fraction-digits'</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'text-font'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Open Sans Semibold'</span><span class="token punctuation">,</span> <span class="token string">'Arial Unicode MS Bold'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'text-size'</span><span class="token operator">:</span> <span class="token number">10</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'paint'</span><span class="token operator">:</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string-property property">'text-color'</span><span class="token operator">:</span> <span class="token punctuation">[</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'case'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">[</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'mag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'black'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'white'</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">]</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// objects for caching and keeping track of HTML marker objects (for performance)</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> markers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> markersOnScreen <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">function</span> <span class="token function">updateMarkers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> newMarkers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> features <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">querySourceFeatures</span><span class="token punctuation">(</span><span class="token string">'earthquakes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// for every cluster on the screen, create an HTML marker for it (if we didn't yet),</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// and add it to the map if it's not there already</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> features<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> coords <span class="token operator">=</span> features<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>coordinates<span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> props <span class="token operator">=</span> features<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>props<span class="token punctuation">.</span>cluster<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> id <span class="token operator">=</span> props<span class="token punctuation">.</span>cluster_id<span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> marker <span class="token operator">=</span> markers<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>marker<span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> el <span class="token operator">=</span> <span class="token function">createDonutChart</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px">marker <span class="token operator">=</span> markers<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">maplibregl<span class="token punctuation">.</span>Marker</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:185.39999999999998px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token literal-property property">element</span><span class="token operator">:</span> el</div></div><div class="pr12" style="padding-left:156.5px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setLngLat</span><span class="token punctuation">(</span>coords<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px">newMarkers<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> marker<span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>markersOnScreen<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> marker<span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// for every marker we've added previously, remove those that are no longer visible</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">for</span> <span class="token punctuation">(</span>id <span class="token keyword">in</span> markersOnScreen<span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newMarkers<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> markersOnScreen<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">markersOnScreen <span class="token operator">=</span> newMarkers<span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// after the GeoJSON data is loaded, update markers on the screen and do so on every map move/moveend</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px">map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>sourceId <span class="token operator">!==</span> <span class="token string">'earthquakes'</span> <span class="token operator">||</span> <span class="token operator">!</span>e<span class="token punctuation">.</span>isSourceLoaded<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'move'</span><span class="token punctuation">,</span> updateMarkers<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'moveend'</span><span class="token punctuation">,</span> updateMarkers<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token function">updateMarkers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token comment">// code for creating an SVG donut chart from feature properties</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">function</span> <span class="token function">createDonutChart</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> offsets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> counts <span class="token operator">=</span> <span class="token punctuation">[</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">props<span class="token punctuation">.</span>mag1<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">props<span class="token punctuation">.</span>mag2<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">props<span class="token punctuation">.</span>mag3<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">props<span class="token punctuation">.</span>mag4<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">props<span class="token punctuation">.</span>mag5</div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">]</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> counts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">offsets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">total <span class="token operator">+=</span> counts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> fontSize <span class="token operator">=</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">total <span class="token operator">>=</span> <span class="token number">1000</span> <span class="token operator">?</span> <span class="token number">22</span> <span class="token operator">:</span> total <span class="token operator">>=</span> <span class="token number">100</span> <span class="token operator">?</span> <span class="token number">20</span> <span class="token operator">:</span> total <span class="token operator">>=</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token number">18</span> <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> r <span class="token operator">=</span> total <span class="token operator">>=</span> <span class="token number">1000</span> <span class="token operator">?</span> <span class="token number">50</span> <span class="token operator">:</span> total <span class="token operator">>=</span> <span class="token number">100</span> <span class="token operator">?</span> <span class="token number">32</span> <span class="token operator">:</span> total <span class="token operator">>=</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token number">24</span> <span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> r0 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>r <span class="token operator">*</span> <span class="token number">0.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> w <span class="token operator">=</span> r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> html <span class="token operator">=</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'&lt;div>&lt;svg width="'</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">w <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'" height="'</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">w <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'" viewbox="0 0 '</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">w <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">' '</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">w <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'" text-anchor="middle" style="font: '</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">fontSize <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'px sans-serif; display: block">'</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> counts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">html <span class="token operator">+=</span> <span class="token function">donutSegment</span><span class="token punctuation">(</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px">offsets<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> total<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">(</span>offsets<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> counts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> total<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px">r<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px">r0<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:127.6px"><div style="text-indent:-14.45px;margin-left:14.45px">colors<span class="token punctuation">[</span>i<span class="token punctuation">]</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px">html <span class="token operator">+=</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'&lt;circle cx="'</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'" cy="'</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'" r="'</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r0 <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'" fill="white" />&lt;text dominant-baseline="central" transform="translate('</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">', '</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">')">'</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">total<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'&lt;/text>&lt;/svg>&lt;/div>'</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px">el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">return</span> el<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">function</span> <span class="token function">donutSegment</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> r<span class="token punctuation">,</span> r0<span class="token punctuation">,</span> color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">if</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> end <span class="token operator">-=</span> <span class="token number">0.00001</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> a0 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token punctuation">(</span>start <span class="token operator">-</span> <span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> <span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> x0 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>a0<span class="token punctuation">)</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">y0 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>a0<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> x1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">y1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">var</span> largeArc <span class="token operator">=</span> end <span class="token operator">-</span> start <span class="token operator">></span> <span class="token number">0.5</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token keyword">return</span> <span class="token punctuation">[</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'&lt;path d="M'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span> r0 <span class="token operator">*</span> x0<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span> r0 <span class="token operator">*</span> y0<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'L'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span> r <span class="token operator">*</span> x0<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span> r <span class="token operator">*</span> y0<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'A'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token number">0</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">largeArc<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token number">1</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span> r <span class="token operator">*</span> x1<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span> r <span class="token operator">*</span> y1<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'L'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span> r0 <span class="token operator">*</span> x1<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span> r0 <span class="token operator">*</span> y1<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'A'</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r0<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r0<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token number">0</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">largeArc<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token number">0</span><span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span> r0 <span class="token operator">*</span> x0<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px">r <span class="token operator">+</span> r0 <span class="token operator">*</span> y0<span class="token punctuation">,</span></div></div><div class="pr12" style="padding-left:98.69999999999999px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token string">'" fill="'</span> <span class="token operator">+</span> color <span class="token operator">+</span> <span class="token string">'" />'</span></div></div><div class="pr12" style="padding-left:69.8px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="pr12" style="padding-left:40.9px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token punctuation">}</span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"> </div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></div></div><div class="pr12" style="padding-left:12px"><div style="text-indent:-14.45px;margin-left:14.45px"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></div></div></div></code></pre><div class="absolute z2 top right mr6 mt6 color-white"><div class="inline-block"><button aria-label="Copy" type="button" class="btn btn--xs py3 px3 round" data-clipboard-text="&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot; /&gt;
&lt;title&gt;Display HTML clusters with custom properties&lt;/title&gt;
&lt;meta name=&quot;viewport&quot; content=&quot;initial-scale=1,maximum-scale=1,user-scalable=no&quot; /&gt;
&lt;script src=&quot;https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.js&quot;&gt;&lt;/script&gt;
&lt;link href=&quot;https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.css&quot; rel=&quot;stylesheet&quot; /&gt;
&lt;style&gt;
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;map&quot;&gt;&lt;/div&gt;

&lt;script&gt;
    var map = new maplibregl.Map({
        container: &#x27;map&#x27;,
        zoom: 0.3,
        center: [0, 20],
        style:
            &#x27;https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL&#x27;
    });

    map.addControl(new maplibregl.NavigationControl());

    // filters for classifying earthquakes into five categories based on magnitude
    var mag1 = [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 2];
    var mag2 = [&#x27;all&#x27;, [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 2], [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 3]];
    var mag3 = [&#x27;all&#x27;, [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 3], [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 4]];
    var mag4 = [&#x27;all&#x27;, [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 4], [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 5]];
    var mag5 = [&#x27;&gt;=&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 5];

    // colors to use for the categories
    var colors = [&#x27;#fed976&#x27;, &#x27;#feb24c&#x27;, &#x27;#fd8d3c&#x27;, &#x27;#fc4e2a&#x27;, &#x27;#e31a1c&#x27;];

    map.on(&#x27;load&#x27;, function () {
        // add a clustered GeoJSON source for a sample set of earthquakes
        map.addSource(&#x27;earthquakes&#x27;, {
            &#x27;type&#x27;: &#x27;geojson&#x27;,
            &#x27;data&#x27;:
                &#x27;https://maplibre.org/maplibre-gl-js-docs/assets/earthquakes.geojson&#x27;,
            &#x27;cluster&#x27;: true,
            &#x27;clusterRadius&#x27;: 80,
            &#x27;clusterProperties&#x27;: {
                // keep separate counts for each magnitude category in a cluster
                &#x27;mag1&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag1, 1, 0]],
                &#x27;mag2&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag2, 1, 0]],
                &#x27;mag3&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag3, 1, 0]],
                &#x27;mag4&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag4, 1, 0]],
                &#x27;mag5&#x27;: [&#x27;+&#x27;, [&#x27;case&#x27;, mag5, 1, 0]]
            }
        });
        // circle and symbol layers for rendering individual earthquakes (unclustered points)
        map.addLayer({
            &#x27;id&#x27;: &#x27;earthquake_circle&#x27;,
            &#x27;type&#x27;: &#x27;circle&#x27;,
            &#x27;source&#x27;: &#x27;earthquakes&#x27;,
            &#x27;filter&#x27;: [&#x27;!=&#x27;, &#x27;cluster&#x27;, true],
            &#x27;paint&#x27;: {
                &#x27;circle-color&#x27;: [
                    &#x27;case&#x27;,
                    mag1,
                    colors[0],
                    mag2,
                    colors[1],
                    mag3,
                    colors[2],
                    mag4,
                    colors[3],
                    colors[4]
                ],
                &#x27;circle-opacity&#x27;: 0.6,
                &#x27;circle-radius&#x27;: 12
            }
        });
        map.addLayer({
            &#x27;id&#x27;: &#x27;earthquake_label&#x27;,
            &#x27;type&#x27;: &#x27;symbol&#x27;,
            &#x27;source&#x27;: &#x27;earthquakes&#x27;,
            &#x27;filter&#x27;: [&#x27;!=&#x27;, &#x27;cluster&#x27;, true],
            &#x27;layout&#x27;: {
                &#x27;text-field&#x27;: [
                    &#x27;number-format&#x27;,
                    [&#x27;get&#x27;, &#x27;mag&#x27;],
                    { &#x27;min-fraction-digits&#x27;: 1, &#x27;max-fraction-digits&#x27;: 1 }
                ],
                &#x27;text-font&#x27;: [&#x27;Open Sans Semibold&#x27;, &#x27;Arial Unicode MS Bold&#x27;],
                &#x27;text-size&#x27;: 10
            },
            &#x27;paint&#x27;: {
                &#x27;text-color&#x27;: [
                    &#x27;case&#x27;,
                    [&#x27;&lt;&#x27;, [&#x27;get&#x27;, &#x27;mag&#x27;], 3],
                    &#x27;black&#x27;,
                    &#x27;white&#x27;
                ]
            }
        });

        // objects for caching and keeping track of HTML marker objects (for performance)
        var markers = {};
        var markersOnScreen = {};

        function updateMarkers() {
            var newMarkers = {};
            var features = map.querySourceFeatures(&#x27;earthquakes&#x27;);

            // for every cluster on the screen, create an HTML marker for it (if we didn&#x27;t yet),
            // and add it to the map if it&#x27;s not there already
            for (var i = 0; i &lt; features.length; i++) {
                var coords = features[i].geometry.coordinates;
                var props = features[i].properties;
                if (!props.cluster) continue;
                var id = props.cluster_id;

                var marker = markers[id];
                if (!marker) {
                    var el = createDonutChart(props);
                    marker = markers[id] = new maplibregl.Marker({
                        element: el
                    }).setLngLat(coords);
                }
                newMarkers[id] = marker;

                if (!markersOnScreen[id]) marker.addTo(map);
            }
            // for every marker we&#x27;ve added previously, remove those that are no longer visible
            for (id in markersOnScreen) {
                if (!newMarkers[id]) markersOnScreen[id].remove();
            }
            markersOnScreen = newMarkers;
        }

        // after the GeoJSON data is loaded, update markers on the screen and do so on every map move/moveend
        map.on(&#x27;data&#x27;, function (e) {
            if (e.sourceId !== &#x27;earthquakes&#x27; || !e.isSourceLoaded) return;

            map.on(&#x27;move&#x27;, updateMarkers);
            map.on(&#x27;moveend&#x27;, updateMarkers);
            updateMarkers();
        });
    });

    // code for creating an SVG donut chart from feature properties
    function createDonutChart(props) {
        var offsets = [];
        var counts = [
            props.mag1,
            props.mag2,
            props.mag3,
            props.mag4,
            props.mag5
        ];
        var total = 0;
        for (var i = 0; i &lt; counts.length; i++) {
            offsets.push(total);
            total += counts[i];
        }
        var fontSize =
            total &gt;= 1000 ? 22 : total &gt;= 100 ? 20 : total &gt;= 10 ? 18 : 16;
        var r = total &gt;= 1000 ? 50 : total &gt;= 100 ? 32 : total &gt;= 10 ? 24 : 18;
        var r0 = Math.round(r * 0.6);
        var w = r * 2;

        var html =
            &#x27;&lt;div&gt;&lt;svg width=&quot;&#x27; +
            w +
            &#x27;&quot; height=&quot;&#x27; +
            w +
            &#x27;&quot; viewbox=&quot;0 0 &#x27; +
            w +
            &#x27; &#x27; +
            w +
            &#x27;&quot; text-anchor=&quot;middle&quot; style=&quot;font: &#x27; +
            fontSize +
            &#x27;px sans-serif; display: block&quot;&gt;&#x27;;

        for (i = 0; i &lt; counts.length; i++) {
            html += donutSegment(
                offsets[i] / total,
                (offsets[i] + counts[i]) / total,
                r,
                r0,
                colors[i]
            );
        }
        html +=
            &#x27;&lt;circle cx=&quot;&#x27; +
            r +
            &#x27;&quot; cy=&quot;&#x27; +
            r +
            &#x27;&quot; r=&quot;&#x27; +
            r0 +
            &#x27;&quot; fill=&quot;white&quot; /&gt;&lt;text dominant-baseline=&quot;central&quot; transform=&quot;translate(&#x27; +
            r +
            &#x27;, &#x27; +
            r +
            &#x27;)&quot;&gt;&#x27; +
            total.toLocaleString() +
            &#x27;&lt;/text&gt;&lt;/svg&gt;&lt;/div&gt;&#x27;;

        var el = document.createElement(&#x27;div&#x27;);
        el.innerHTML = html;
        return el.firstChild;
    }

    function donutSegment(start, end, r, r0, color) {
        if (end - start === 1) end -= 0.00001;
        var a0 = 2 * Math.PI * (start - 0.25);
        var a1 = 2 * Math.PI * (end - 0.25);
        var x0 = Math.cos(a0),
            y0 = Math.sin(a0);
        var x1 = Math.cos(a1),
            y1 = Math.sin(a1);
        var largeArc = end - start &gt; 0.5 ? 1 : 0;

        return [
            &#x27;&lt;path d=&quot;M&#x27;,
            r + r0 * x0,
            r + r0 * y0,
            &#x27;L&#x27;,
            r + r * x0,
            r + r * y0,
            &#x27;A&#x27;,
            r,
            r,
            0,
            largeArc,
            1,
            r + r * x1,
            r + r * y1,
            &#x27;L&#x27;,
            r + r0 * x1,
            r + r0 * y1,
            &#x27;A&#x27;,
            r0,
            r0,
            0,
            largeArc,
            0,
            r + r0 * x0,
            r + r0 * y0,
            &#x27;&quot; fill=&quot;&#x27; + color + &#x27;&quot; /&gt;&#x27;
        ].join(&#x27; &#x27;);
    }
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;"><svg role="presentation" focusable="false" class="events-none icon" style="width:18px;height:18px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-clipboard"></use></svg></button><div class="hide-visually" role="tooltip"><div class="txt-s wmax240">Copy</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="fixed block none-mm mx24 my24 z5 bottom right"><div class="block mx24 my24 z5"><div class="inline-block"><button type="button" class="btn--blue w60 h60 px0 round-full shadow-darken25 color-white flex-parent flex-parent--center-main flex-parent--center-cross" aria-label="Back to top"><svg role="presentation" focusable="false" class="events-none icon" style="width:30px;height:30px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-arrow-up"></use></svg></button></div></div></div></main></div><div class="shell-flex-child shell-flex-child--no-shrink shell-wrapper"><footer id="page-footer" class="shell-py12 shell-py48-ml" data-swiftype-index="false"><div class="limiter limiter--wide"><div id="page-footer-legal-social" class="shell-grid shell-txt-s shell-color-gray shell-py12 shell-py0-ml"><div class="shell-col shell-col--12 shell-col--6-mm shell-my12"><a class="shell-link shell-color-gray shell-color-gray-dark-on-hover shell-mr18" href="https://maplibre.org/">MapLibre</a></div><div class="shell-col shell-col--12 shell-col--6-mm shell-my12 shell-align-r-mm"><a aria-label="Github" class="shell-color-blue shell-color-blue-dark-on-hover shell-inline-block shell-w36" href="https://github.com/maplibre"><svg viewBox="0 0 1790 1790" class="shell-icon shell-icon--s shell-inline"><path d="M704 1216q0 40-12.5 82t-43 76-72.5 34-72.5-34-43-76-12.5-82 12.5-82 43-76 72.5-34 72.5 34 43 76 12.5 82zm640 0q0 40-12.5 82t-43 76-72.5 34-72.5-34-43-76-12.5-82 12.5-82 43-76 72.5-34 72.5 34 43 76 12.5 82zm160 0q0-120-69-204t-187-84q-41 0-195 21-71 11-157 11t-157-11q-152-21-195-21-118 0-187 84t-69 204q0 88 32 153.5t81 103 122 60 140 29.5 149 7h168q82 0 149-7t140-29.5 122-60 81-103 32-153.5zm224-176q0 207-61 331-38 77-105.5 133t-141 86-170 47.5-171.5 22-167 4.5q-78 0-142-3t-147.5-12.5-152.5-30-137-51.5-121-81-86-115q-62-123-62-331 0-237 136-396-27-82-27-170 0-116 51-218 108 0 190 39.5t189 123.5q147-35 309-35 148 0 280 32 105-82 187-121t189-39q51 102 51 218 0 87-27 168 136 160 136 398z"></path></svg></a><a aria-label="Twitter" class="shell-color-blue shell-color-blue-dark-on-hover shell-inline-block shell-w36" href="https://twitter.com/maplibre/"><svg viewBox="0 0 50 50" class="shell-icon shell-icon--s shell-inline"><g id="77744030-a5d8-4d71-88ad-2c70d4dcad7b" data-name="svg"><path d="M15.72,45.31c18.87,0,29.19-15.63,29.19-29.19,0-.44,0-.89,0-1.33A20.87,20.87,0,0,0,50,9.49a20.48,20.48,0,0,1-5.89,1.61,10.29,10.29,0,0,0,4.51-5.67A20.56,20.56,0,0,1,42.1,7.92a10.27,10.27,0,0,0-17.48,9.36A29.12,29.12,0,0,1,3.48,6.56,10.27,10.27,0,0,0,6.66,20.25,10.18,10.18,0,0,1,2,19v.13a10.26,10.26,0,0,0,8.23,10.06,10.24,10.24,0,0,1-4.63.18,10.27,10.27,0,0,0,9.58,7.12,20.58,20.58,0,0,1-12.74,4.4A20.88,20.88,0,0,1,0,40.71a29,29,0,0,0,15.72,4.6"></path></g></svg></a></div></div></div></footer></div></div></div></div><div><script>!function(r){function e(e){for(var a,l,s=e[0],c=e[1],p=e[2],d=0,o=[];d<s.length;d++)l=s[d],Object.prototype.hasOwnProperty.call(i,l)&&i[l]&&o.push(i[l][0]),i[l]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(r[a]=c[a]);for(t&&t(e);o.length;)o.shift()();return b.push.apply(b,p||[]),m()}function m(){for(var e,a=0;a<b.length;a++){for(var l=b[a],s=!0,c=1;c<l.length;c++){var p=l[c];0!==i[p]&&(s=!1)}s&&(b.splice(a--,1),e=f(f.s=l[0]))}return e}var l={},i={5:0},b=[];function f(e){if(l[e])return l[e].exports;var a=l[e]={i:e,l:!1,exports:{}};return r[e].call(a.exports,a,a.exports,f),a.l=!0,a.exports}f.e=function(s){var e,c,p,a,d,l=[],o=i[s];return 0!==o&&(o?l.push(o[2]):(e=new Promise(function(e,a){o=i[s]=[e,a]}),l.push(o[2]=e),(c=document.createElement("script")).charset="utf-8",c.timeout=120,f.nc&&c.setAttribute("nonce",f.nc),c.src=f.p+""+({0:"maplibre-gl-js-docs-api~maplibre-gl-js-docs-api-events~maplibre-gl-js-docs-api-geography~maplibre-gl~a6f9e869",1:"vendors~maplibre-gl-js-docs-api~maplibre-gl-js-docs-api-events~maplibre-gl-js-docs-api-geography~map~61761734",2:"vendors~maplibre-gl-js-docs-api~maplibre-gl-js-docs-api-events~maplibre-gl-js-docs-api-geography~map~690a76a7",3:"vendors~maplibre-gl-js-docs-api-events~maplibre-gl-js-docs-api-geography~maplibre-gl-js-docs-api-han~d180d8c4",6:"maplibre-gl-js-docs",7:"maplibre-gl-js-docs-api",8:"maplibre-gl-js-docs-api-events",9:"maplibre-gl-js-docs-api-geography",10:"maplibre-gl-js-docs-api-handlers",11:"maplibre-gl-js-docs-api-map",12:"maplibre-gl-js-docs-api-markers",13:"maplibre-gl-js-docs-api-properties",14:"maplibre-gl-js-docs-api-sources",15:"maplibre-gl-js-docs-example",16:"maplibre-gl-js-docs-example-3d-buildings",17:"maplibre-gl-js-docs-example-3d-extrusion-floorplan",18:"maplibre-gl-js-docs-example-3d-terrain",19:"maplibre-gl-js-docs-example-add-3d-model",20:"maplibre-gl-js-docs-example-add-3d-model-babylon",21:"maplibre-gl-js-docs-example-add-a-marker",22:"maplibre-gl-js-docs-example-add-image",23:"maplibre-gl-js-docs-example-add-image-animated",24:"maplibre-gl-js-docs-example-add-image-generated",25:"maplibre-gl-js-docs-example-add-image-missing-generated",26:"maplibre-gl-js-docs-example-add-image-stretchable",27:"maplibre-gl-js-docs-example-animate-a-line",28:"maplibre-gl-js-docs-example-animate-camera-around-point",29:"maplibre-gl-js-docs-example-animate-images",30:"maplibre-gl-js-docs-example-animate-marker",31:"maplibre-gl-js-docs-example-animate-point-along-line",32:"maplibre-gl-js-docs-example-animate-point-along-route",33:"maplibre-gl-js-docs-example-attribution-position",34:"maplibre-gl-js-docs-example-camera-animation",35:"maplibre-gl-js-docs-example-canvas-source",36:"maplibre-gl-js-docs-example-center-on-symbol",37:"maplibre-gl-js-docs-example-change-building-color-based-on-zoom-level",38:"maplibre-gl-js-docs-example-change-case-of-labels",39:"maplibre-gl-js-docs-example-check-for-support",40:"maplibre-gl-js-docs-example-cluster",41:"maplibre-gl-js-docs-example-cluster-html",42:"maplibre-gl-js-docs-example-color-switcher",43:"maplibre-gl-js-docs-example-custom-marker-icons",44:"maplibre-gl-js-docs-example-custom-style-layer",45:"maplibre-gl-js-docs-example-data-driven-lines",46:"maplibre-gl-js-docs-example-disable-rotation",47:"maplibre-gl-js-docs-example-disable-scroll-zoom",48:"maplibre-gl-js-docs-example-display-and-style-rich-text-labels",49:"maplibre-gl-js-docs-example-drag-a-marker",50:"maplibre-gl-js-docs-example-drag-a-point",51:"maplibre-gl-js-docs-example-fallback-image",52:"maplibre-gl-js-docs-example-featuresat",53:"maplibre-gl-js-docs-example-fill-pattern",54:"maplibre-gl-js-docs-example-filter-markers",55:"maplibre-gl-js-docs-example-filter-markers-by-input",56:"maplibre-gl-js-docs-example-fitbounds",57:"maplibre-gl-js-docs-example-flyto",58:"maplibre-gl-js-docs-example-flyto-options",59:"maplibre-gl-js-docs-example-fullscreen",60:"maplibre-gl-js-docs-example-game-controls",61:"maplibre-gl-js-docs-example-geocoder",62:"maplibre-gl-js-docs-example-geojson-layer-in-stack",63:"maplibre-gl-js-docs-example-geojson-line",64:"maplibre-gl-js-docs-example-geojson-markers",65:"maplibre-gl-js-docs-example-geojson-polygon",66:"maplibre-gl-js-docs-example-heatmap",67:"maplibre-gl-js-docs-example-heatmap-layer",68:"maplibre-gl-js-docs-example-hover-styles",69:"maplibre-gl-js-docs-example-interactive-false",70:"maplibre-gl-js-docs-example-jump-to",71:"maplibre-gl-js-docs-example-language-switch",72:"maplibre-gl-js-docs-example-line-across-180th-meridian",73:"maplibre-gl-js-docs-example-line-gradient",74:"maplibre-gl-js-docs-example-live-geojson",75:"maplibre-gl-js-docs-example-live-update-feature",76:"maplibre-gl-js-docs-example-local-geojson",77:"maplibre-gl-js-docs-example-local-geojson-experimental",78:"maplibre-gl-js-docs-example-local-ideographs",79:"maplibre-gl-js-docs-example-locate-user",80:"maplibre-gl-js-docs-example-map-tiles",81:"maplibre-gl-js-docs-example-mapbox-gl-draw",82:"maplibre-gl-js-docs-example-mapbox-gl-rtl-text",83:"maplibre-gl-js-docs-example-mapbox-gl-supported",84:"maplibre-gl-js-docs-example-marker-popup",85:"maplibre-gl-js-docs-example-measure",86:"maplibre-gl-js-docs-example-mouse-position",87:"maplibre-gl-js-docs-example-multiple-geometries",88:"maplibre-gl-js-docs-example-navigation",89:"maplibre-gl-js-docs-example-offset-vanishing-point-with-padding",90:"maplibre-gl-js-docs-example-polygon-popup-on-click",91:"maplibre-gl-js-docs-example-popup",92:"maplibre-gl-js-docs-example-popup-on-click",93:"maplibre-gl-js-docs-example-popup-on-hover",94:"maplibre-gl-js-docs-example-queryrenderedfeatures",95:"maplibre-gl-js-docs-example-render-world-copies",96:"maplibre-gl-js-docs-example-restrict-bounds",97:"maplibre-gl-js-docs-example-satellite-map",98:"maplibre-gl-js-docs-example-scroll-fly-to",99:"maplibre-gl-js-docs-example-set-perspective",100:"maplibre-gl-js-docs-example-set-popup",101:"maplibre-gl-js-docs-example-simple-map",102:"maplibre-gl-js-docs-example-third-party",103:"maplibre-gl-js-docs-example-timeline-animation",104:"maplibre-gl-js-docs-example-toggle-interaction-handlers",105:"maplibre-gl-js-docs-example-using-featuresin",106:"maplibre-gl-js-docs-example-variable-label-placement",107:"maplibre-gl-js-docs-example-vector-source",108:"maplibre-gl-js-docs-example-video-on-a-map",109:"maplibre-gl-js-docs-example-visualize-population-density",110:"maplibre-gl-js-docs-example-wms",111:"maplibre-gl-js-docs-example-zoomto-linestring",112:"maplibre-gl-js-docs-examples",113:"maplibre-gl-js-docs-overview",114:"maplibre-gl-js-docs-plugins",116:"vendors~assembly-js",117:"vendors~maplibre-gl-js-docs-plugins"}[s]||s)+"-"+{0:"97c0bf60bc047e2f4aba",1:"26d106bd90fbf31bdf15",2:"468c7d1fe8e69d4c987e",3:"29bbcc5abb14b769ffa7",6:"548006dee9e8f87fdaba",7:"53e8d676f065a060fb7c",8:"fccffd6f23c67ab7ee55",9:"76c082598e876cd605f5",10:"f2c19e90984d26749e23",11:"f3bf27334b1ff754bc1f",12:"d4116b14c96a8ce7e211",13:"9ed9170247c54255b6c4",14:"2d434f25c886a3a7aca2",15:"900e65a5f5268048402a",16:"cf0cdf2c082a81f0c40c",17:"545cd7dc877c3aa29667",18:"332bea77fdac6c2f8980",19:"7177414cf6bf646b0c7a",20:"105ce742f77dcce9dd7f",21:"2ac06843b06beddcbf7c",22:"479dcf21b6962461802b",23:"7c206d517b248eda4f0b",24:"6dd22bbbf62bebec74a9",25:"46ce7d6c22341eb6240b",26:"3effdf07e13848ac549a",27:"f5c1078ee754d7ac6ef1",28:"27c2e7f6a34d5fa14ed7",29:"3052bdad3402a1a22cc2",30:"5bb5bb06fc7d81ff9385",31:"2e6ee213c5f3a8899ae8",32:"de7c06edd086672945ea",33:"c8129491fb035febb260",34:"4f64de0e136a2fa8fddf",35:"8db345e524e60c5f9f6a",36:"5860178a8103386d7cd5",37:"fd41ea422949719eb286",38:"54386e749d11823543dc",39:"8fff107d499505e9d56d",40:"f97911f2f46560d21d58",41:"9a6c0b6097896c21f3e9",42:"55ee8ef664dd55fe0452",43:"5f399a3a19929a05cac7",44:"ce72e223cf95cc8743b0",45:"e242d70c0b11db2f9cac",46:"d094bcd51a7383f974dc",47:"18731a4c17345906ef90",48:"132ef79a40ec602dcbec",49:"bfc2bb9d1dd97cc505e7",50:"da59f67c3f9e674a78b8",51:"972cfb0608682087d5fe",52:"1eee0aa3fa32f3bed322",53:"f4978eac86f2fde64b31",54:"63f5d8ccce902d22d57f",55:"e53a850f8d034954868e",56:"1deceab8d0d5bb412364",57:"f9a63ffe290e089e6afb",58:"6d925ffee1d88ee39e28",59:"ec93ced74b54ed984d1b",60:"3728a33677c43365d4fe",61:"5375b61e03d371059ded",62:"b4591549d5bd6cfe63ff",63:"1858e91538822a2d5fad",64:"4a215e30fb5132076a3c",65:"677d980b4f1c92be57e1",66:"460865132a3ba8628344",67:"f44f7738e1d736e9a181",68:"39b2e041df3a2f6453bc",69:"a1903988c90a3038dc93",70:"b14b8f45e9906761f048",71:"3c27db1706173a5bb0fd",72:"970808f1fea29d37ae80",73:"cd34ddc938aaef1acf66",74:"20e8b6ef8c6b8e07615a",75:"e5796a702ccfc8759eb6",76:"89aca83d0766ae1025a1",77:"6e73944baa9c16745225",78:"d3a788ee26966f99eab7",79:"756f1562e56c78569e9a",80:"1c00d78eced70db5d5c3",81:"d2ac21fc95f5ba0b7864",82:"fd684d430f7a04f957ff",83:"ddcdf1b9d5948bd89506",84:"f9eefacb850138bde38b",85:"a584b17992f193a682aa",86:"c98827acf84a4b30727c",87:"5e6bc9194c68520fba18",88:"cb53e2bac87841f59e2d",89:"015e7d05b47f16c2669e",90:"3798eb21400712901126",91:"79af566740d23b8ed7a7",92:"bc4965541a05b77e0c64",93:"c785c3abb81c0c48fd66",94:"d1fb27096230f7c7fa44",95:"155196fc043c14319121",96:"6aafc253459faacf5af0",97:"08485824a0da1d45d3f9",98:"bb026f55e30861bcc039",99:"588079563afb6ed713a0",100:"caf858ba9c541e8e6db8",101:"73b9c534af8ae8c63ada",102:"b5b527878372019c5599",103:"8340973173f2bdb6a400",104:"73473d8007fd8045f1fa",105:"c4b391e28343e8324cec",106:"910ca4844f0b2a45a959",107:"74646694e9c8cb17abb2",108:"cf6b840816772052f9fc",109:"1842b28cecf2fe17c9f1",110:"fe1649618176e6f4bf10",111:"9401dc84aa675860c6fa",112:"493925e903a52a251c7a",113:"603d102e53032fd19c8c",114:"5f93f7049ceb7f4beec6",116:"6e631625f343924c71a8",117:"3c294ff770d9b07c0997"}[s]+".chunk.js",p=new Error,a=function(e){c.onerror=c.onload=null,clearTimeout(d);var a,l=i[s];0!==l&&(l&&(a=e&&("load"===e.type?"missing":e.type),e=e&&e.target&&e.target.src,p.message="Loading chunk "+s+" failed.\n("+a+": "+e+")",p.name="ChunkLoadError",p.type=a,p.request=e,l[1](p)),i[s]=void 0)},d=setTimeout(function(){a({type:"timeout",target:c})},12e4),c.onerror=c.onload=a,document.head.appendChild(c))),Promise.all(l)},f.m=r,f.c=l,f.d=function(e,a,l){f.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:l})},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.t=function(a,e){if(1&e&&(a=f(a)),8&e)return a;if(4&e&&"object"==typeof a&&a&&a.__esModule)return a;var l=Object.create(null);if(f.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:a}),2&e&&"string"!=typeof a)for(var s in a)f.d(l,s,function(e){return a[e]}.bind(null,s));return l},f.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(a,"a",a),a},f.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},f.p="/maplibre-gl-js-docs/assets/",f.oe=function(e){throw console.error(e),e};var a=(s=window.webpackJsonp=window.webpackJsonp||[]).push.bind(s);s.push=e;for(var s=s.slice(),c=0;c<s.length;c++)e(s[c]);var t=a;m()}([]);</script>
<script src="/maplibre-gl-js-docs/assets/vendor-5bb4a949cdb267b046df.chunk.js"></script>
<script src="/maplibre-gl-js-docs/assets/app-29b020a03bb0cc78ba5b.chunk.js"></script></div></body></html>